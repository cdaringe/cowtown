<!DOCTYPE html><html lang="en"><head><meta charSet="utf-8"/><meta http-equiv="x-ua-compatible" content="ie=edge"/><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"/><style data-href="/styles.8c896daec337640840a2.css">html{color:#333;font-family:-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Helvetica,Arial,sans-serif,Apple Color Emoji,Segoe UI Emoji,Segoe UI Symbol;font-size:14px;line-height:22px;-ms-text-size-adjust:100%;-webkit-text-size-adjust:100%;-moz-osx-font-smoothing:grayscale}#___gatsby,#___gatsby>*,body,html{height:100%;margin:0;padding:0}tHead{border-bottom:1px solid silver}code[class*=language-],pre[class*=language-]{color:#f8f8f2;background:none;text-shadow:0 1px rgba(0,0,0,.3);font-family:Consolas,Monaco,Andale Mono,Ubuntu Mono,monospace;font-size:1em;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-ms-hyphens:none;hyphens:none}pre[class*=language-]{padding:1em;margin:.5em 0;overflow:auto;border-radius:.3em}:not(pre)>code[class*=language-],pre[class*=language-]{background:#272822}:not(pre)>code[class*=language-]{padding:.1em;border-radius:.3em;white-space:normal}.token.cdata,.token.comment,.token.doctype,.token.prolog{color:#708090}.token.punctuation{color:#f8f8f2}.namespace{opacity:.7}.token.constant,.token.deleted,.token.property,.token.symbol,.token.tag{color:#f92672}.token.boolean,.token.number{color:#ae81ff}.token.attr-name,.token.builtin,.token.char,.token.inserted,.token.selector,.token.string{color:#a6e22e}.language-css .token.string,.style .token.string,.token.entity,.token.operator,.token.url,.token.variable{color:#f8f8f2}.token.atrule,.token.attr-value,.token.class-name,.token.function{color:#e6db74}.token.keyword{color:#66d9ef}.token.important,.token.regex{color:#fd971f}.token.bold,.token.important{font-weight:700}.token.italic{font-style:italic}.token.entity{cursor:help}</style><meta name="generator" content="Gatsby 2.3.3"/><title data-react-helmet="true">Home | cowtown</title><meta data-react-helmet="true" name="description" content="cowtown docs &amp; recipes"/><meta data-react-helmet="true" property="og:title" content="Home"/><meta data-react-helmet="true" property="og:description" content="cowtown docs &amp; recipes"/><meta data-react-helmet="true" property="og:type" content="website"/><meta data-react-helmet="true" name="twitter:card" content="summary"/><meta data-react-helmet="true" name="twitter:creator" content="@cdaringe"/><meta data-react-helmet="true" name="twitter:title" content="Home"/><meta data-react-helmet="true" name="twitter:description" content="cowtown docs &amp; recipes"/><meta data-react-helmet="true" name="keywords" content="gatsby, application, react"/><style data-styled="gLjILa jfsqqm gZgQLg FNJEX iwruyZ iiTMcI jsyzet kUvbQY eAhtju exioTG jfrkmZ dKQhfr iZyUgN fEGoZj eFqDVI jgQxbh dERKfM hEaywI flReVN" data-styled-version="4.2.0">
/* sc-component-id: sidebar__View-sc-1yo06dp-0 */
.gLjILa{bottom:0;display:block;position:fixed;background-color:#2e3336;left:0;overflow-y:auto;top:0;width:230px;}
/* sc-component-id: sidebar__Title-sc-1yo06dp-1 */
.jfsqqm{color:white;font-size:20px;padding:1rem;text-align:center;}
/* sc-component-id: sidebar__List-sc-1yo06dp-2 */
.gZgQLg{display:block;list-style:none;margin:0;padding:0;}
/* sc-component-id: sidebar__Item-sc-1yo06dp-3 */
.FNJEX{color:white;display:list-item;} .FNJEX:hover{background-color:#3076cd;}
/* sc-component-id: sidebar__Anchor-sc-1yo06dp-4 */
.iwruyZ{line-height:28px;padding:0 15px 0 15px;display:block;overflow-x:hidden;white-space:nowrap;text-overflow:ellipsis;-webkit-text-decoration:none;text-decoration:none;color:#fff;-webkit-transition-property:background;transition-property:background;-webkit-transition-timing-function:linear;transition-timing-function:linear;-webkit-transition-duration:130ms;transition-duration:130ms;}
/* sc-component-id: blockquote__Blockquote-l1ah9g-0 */
.jgQxbh{background-color:#191c1e;box-sizing:border-box;clear:right;color:white;display:block;float:right;font-size:14px;margin:0;width:50%;}
/* sc-component-id: default__Default-sc-41z5l2-0 */
.fEGoZj{padding:0.5em 28px;width:50%;}
/* sc-component-id: div__Div-sc-1l67xj5-0 */
.dERKfM{background-color:#1e2123;box-sizing:border-box;clear:right;color:#fff;display:block;float:right;margin:0;overflow:auto;-webkit-text-size-adjust:100%;padding:2em 28px;width:50%;}
/* sc-component-id: paragraph__Paragraph-sc-2voub2-0 */
.dKQhfr{display:block;box-sizing:border-box;padding:0 28px;width:50%;} .blockquote__Blockquote-l1ah9g-0 .dKQhfr{width:100%;}
/* sc-component-id: code__Code-sc-1mcw21l-0 */
.flReVN{color:#eee;font-family:monospace;-webkit-hyphens:auto;-moz-hyphens:auto;-ms-hyphens:auto;hyphens:auto;line-height:1.5;padding:0;margin:0;word-break:break-all;white-space:pre;} .paragraph__Paragraph-sc-2voub2-0 .flReVN,.aside__Aside-sc-1i6cttl-0 .flReVN{background-color:rgba(0,0,0,0.05);border-radius:2px;color:rgb(51,51,51);display:inline;font-size:12px;font-family:Consolas,Menlo,Monaco,'Lucida Console','Liberation Mono','DejaVu Sans Mono','Bitstream Vera Sans Mono','Courier New',monospace,serif;padding:4px;} .blockquote__Blockquote-l1ah9g-0 .flReVN{color:white;}
/* sc-component-id: heading__Heading1-sc-16djx8k-0 */
.jfrkmZ{background-color:white;border-bottom:1px solid #ccc;border-top:1px solid silver;box-sizing:border-box;clear:both;display:block;font-size:25px;line-height:normal;padding:0.5em 28px;margin-bottom:21px;margin-right:50%;margin-top:2em;width:50%;} .jfrkmZ:first-child{margin-top:0;border-top-width:0;}
/* sc-component-id: pre__Pre-sc-1ql72bi-0 */
.hEaywI{background-color:#1e2123 !important;box-sizing:border-box;display:block;white-space:pre;}
/* sc-component-id: language-selector__View-lgqfz5-0 */
.kUvbQY{background-color:#1e2224;display:block;position:fixed;width:100%;z-index:50;}
/* sc-component-id: language-selector__Item-lgqfz5-1 */
.eAhtju{display:block;float:left;font-size:14px;font-weight:bold;background-color:#2e3336;color:#fff;-webkit-text-decoration:none;text-decoration:none;padding:0 10px;line-height:30px;outline:0;} .eAhtju:active,.eAhtju:focus{background-color:#2e3336;}
/* sc-component-id: code-box__View-oi53nq-0 */
.jsyzet{background-color:#2e3336;bottom:0;display:block;font-size:14px;position:absolute;right:0;top:0;width:50%;}
/* sc-component-id: page__View-sc-13cab6v-0 */
.iiTMcI{background-color:#f3f7f9;display:block;margin-left:230px;min-height:100%;padding-bottom:1rem;position:relative;z-index:10;}
/* sc-component-id: page__Content-sc-13cab6v-1 */
.exioTG{display:block;position:relative;z-index:30;} .exioTG:after{content:'';display:block;clear:both;}</style><link rel="shortcut icon" href="/icons/icon-48x48.png?v=a4ef940d2b9890a9b3180740b5b42d9e04bea3f9"/><link rel="manifest" href="/manifest.webmanifest"/><meta name="theme-color" content="#663399"/><link rel="apple-touch-icon" sizes="48x48" href="/icons/icon-48x48.png?v=a4ef940d2b9890a9b3180740b5b42d9e04bea3f9"/><link rel="apple-touch-icon" sizes="72x72" href="/icons/icon-72x72.png?v=a4ef940d2b9890a9b3180740b5b42d9e04bea3f9"/><link rel="apple-touch-icon" sizes="96x96" href="/icons/icon-96x96.png?v=a4ef940d2b9890a9b3180740b5b42d9e04bea3f9"/><link rel="apple-touch-icon" sizes="144x144" href="/icons/icon-144x144.png?v=a4ef940d2b9890a9b3180740b5b42d9e04bea3f9"/><link rel="apple-touch-icon" sizes="192x192" href="/icons/icon-192x192.png?v=a4ef940d2b9890a9b3180740b5b42d9e04bea3f9"/><link rel="apple-touch-icon" sizes="256x256" href="/icons/icon-256x256.png?v=a4ef940d2b9890a9b3180740b5b42d9e04bea3f9"/><link rel="apple-touch-icon" sizes="384x384" href="/icons/icon-384x384.png?v=a4ef940d2b9890a9b3180740b5b42d9e04bea3f9"/><link rel="apple-touch-icon" sizes="512x512" href="/icons/icon-512x512.png?v=a4ef940d2b9890a9b3180740b5b42d9e04bea3f9"/><link as="script" rel="preload" href="/webpack-runtime-6115d14da3dfd47827b0.js"/><link as="script" rel="preload" href="/app-50d9e60378460038add4.js"/><link as="script" rel="preload" href="/styles-ee9eff4b2717b93862c1.js"/><link as="script" rel="preload" href="/1-4bdc6f16ab9651364ace.js"/><link as="script" rel="preload" href="/7-34bcfe8349df4b1d1738.js"/><link as="script" rel="preload" href="/component---src-pages-index-js-70d1a2788a0d3b29616f.js"/><link as="fetch" rel="preload" href="/static/d/614/path---index-6a9-Gjol1j7DfW0SZmIz5G7drtMnoig.json" crossorigin="use-credentials"/></head><body><noscript id="gatsby-noscript">This app works best with JavaScript enabled.</noscript><div id="___gatsby"><div style="outline:none" tabindex="-1" role="group"><div class="sidebar__View-sc-1yo06dp-0 gLjILa"><h1 class="sidebar__Title-sc-1yo06dp-1 jfsqqm">cowtown</h1><ul class="sidebar__List-sc-1yo06dp-2 gZgQLg"><li class="sidebar__Item-sc-1yo06dp-3 FNJEX"><a href="#introduction" class="sidebar__Anchor-sc-1yo06dp-4 iwruyZ">introduction</a></li><li class="sidebar__Item-sc-1yo06dp-3 FNJEX"><a href="#goals" class="sidebar__Anchor-sc-1yo06dp-4 iwruyZ">goals</a></li><li class="sidebar__Item-sc-1yo06dp-3 FNJEX"><a href="#getting started" class="sidebar__Anchor-sc-1yo06dp-4 iwruyZ">getting started</a></li><li class="sidebar__Item-sc-1yo06dp-3 FNJEX"><a href="#create a piece of middleware" class="sidebar__Anchor-sc-1yo06dp-4 iwruyZ">create a piece of middleware</a></li><li class="sidebar__Item-sc-1yo06dp-3 FNJEX"><a href="#link middlewares together" class="sidebar__Anchor-sc-1yo06dp-4 iwruyZ">link middlewares together</a></li><li class="sidebar__Item-sc-1yo06dp-3 FNJEX"><a href="#create a basic server" class="sidebar__Anchor-sc-1yo06dp-4 iwruyZ">create a basic server</a></li><li class="sidebar__Item-sc-1yo06dp-3 FNJEX"><a href="#create a hello world server" class="sidebar__Anchor-sc-1yo06dp-4 iwruyZ">create a hello world server</a></li><li class="sidebar__Item-sc-1yo06dp-3 FNJEX"><a href="#perform dummy routing" class="sidebar__Anchor-sc-1yo06dp-4 iwruyZ">perform dummy routing</a></li><li class="sidebar__Item-sc-1yo06dp-3 FNJEX"><a href="#perform basic routing" class="sidebar__Anchor-sc-1yo06dp-4 iwruyZ">perform basic routing</a></li><li class="sidebar__Item-sc-1yo06dp-3 FNJEX"><a href="#manage configuration" class="sidebar__Anchor-sc-1yo06dp-4 iwruyZ">manage configuration</a></li><li class="sidebar__Item-sc-1yo06dp-3 FNJEX"><a href="#gracefully update configuration" class="sidebar__Anchor-sc-1yo06dp-4 iwruyZ">gracefully update configuration</a></li><li class="sidebar__Item-sc-1yo06dp-3 FNJEX"><a href="#upload files" class="sidebar__Anchor-sc-1yo06dp-4 iwruyZ">upload files</a></li><li class="sidebar__Item-sc-1yo06dp-3 FNJEX"><a href="#serve static files" class="sidebar__Anchor-sc-1yo06dp-4 iwruyZ">serve static files</a></li><li class="sidebar__Item-sc-1yo06dp-3 FNJEX"><a href="#serve an api and a web application" class="sidebar__Anchor-sc-1yo06dp-4 iwruyZ">serve an api and a web application</a></li><li class="sidebar__Item-sc-1yo06dp-3 FNJEX"><a href="#isomorphic rendering" class="sidebar__Anchor-sc-1yo06dp-4 iwruyZ">isomorphic rendering</a></li><li class="sidebar__Item-sc-1yo06dp-3 FNJEX"><a href="#performance - reject requests when overloaded" class="sidebar__Anchor-sc-1yo06dp-4 iwruyZ">performance - reject requests when overloaded</a></li><li class="sidebar__Item-sc-1yo06dp-3 FNJEX"><a href="#recipes" class="sidebar__Anchor-sc-1yo06dp-4 iwruyZ">recipes</a></li></ul></div><div class="page__View-sc-13cab6v-0 iiTMcI"><div class="code-box__View-oi53nq-0 jsyzet"><div class="language-selector__View-lgqfz5-0 kUvbQY"><a href="#" class="language-selector__Item-lgqfz5-1 eAhtju">typescript</a></div></div><div class="page__Content-sc-13cab6v-1 exioTG"><h1 class="heading__Heading1-sc-16djx8k-0 jfrkmZ" id="introduction">introduction</h1>
<p class="paragraph__Paragraph-sc-2voub2-0 dKQhfr"><span class="gatsby-resp-image-wrapper span__Span-sc-1x0bjnh-0 iZyUgN" id="
    ">
    <span class="gatsby-resp-image-background-image span__Span-sc-1x0bjnh-0 iZyUgN"></span>
    <div class="gatsby-resp-image-image default__Default-sc-41z5l2-0 fEGoZj"></div>
  </span> cowtown is about delivering value.  cowtown is not about code--it&#x27;s about enabling value streams through code, ideally via functional composition.</p>
<p class="paragraph__Paragraph-sc-2voub2-0 dKQhfr" id="cowtown is not a framework.  quite the opposite--this project aims to show you how
existing, accessible, open middlewares can provide unmatched value.  it&#x27;s about showing
that they are easy to link together, and how deep understanding and simplicity can be
achieved in a server-side web program when using a select few tools strategically.">cowtown is not a framework.  quite the opposite--this project aims to show you how
existing, accessible, open middlewares can provide unmatched value.  it&#x27;s about showing
that they are easy to link together, and how deep understanding and simplicity can be
achieved in a server-side web program when using a select few tools strategically.</p>
<p class="paragraph__Paragraph-sc-2voub2-0 dKQhfr" id="cowtown delivers value through ">cowtown delivers value through <a target="_blank" href="https://koajs.com" class="link__Link-umnslz-0 eFqDVI">koa</a>.  koa does little on its own,
making its docs short and sweet.  even though koa is not batteries included
(i.e. it does little for you on its own), koa does offer a wonderful
request/response context object, which i will use heavily.</p>
<p class="paragraph__Paragraph-sc-2voub2-0 dKQhfr" id="graze the koa docs, then come back for some pragmatic, hands-on examples.">graze the koa docs, then come back for some pragmatic, hands-on examples.</p>
<h1 class="heading__Heading1-sc-16djx8k-0 jfrkmZ" id="goals">goals</h1>
<p class="paragraph__Paragraph-sc-2voub2-0 dKQhfr" id="the following sections describe how to do useful things with koa.">the following sections describe how to do useful things with koa.</p>
<div class="default__Default-sc-41z5l2-0 fEGoZj" id="
">
<div class="default__Default-sc-41z5l2-0 fEGoZj" id="i will explore usages of individual middlewares">i will explore usages of individual middlewares</div>
<div class="default__Default-sc-41z5l2-0 fEGoZj" id="i will explore useful trees of middlewares">i will explore useful trees of middlewares</div>
<div class="default__Default-sc-41z5l2-0 fEGoZj" id="i will explore some full-stack, e2e middleware recipes">i will explore some full-stack, e2e middleware recipes</div>
</div>
<p class="paragraph__Paragraph-sc-2voub2-0 dKQhfr" id="the following sections are not meant to be read in any particular order.  however,
more complicated topics do trend towards the bottom.">the following sections are not meant to be read in any particular order.  however,
more complicated topics do trend towards the bottom.</p>
<h1 class="heading__Heading1-sc-16djx8k-0 jfrkmZ" id="getting started">getting started</h1>
<blockquote class="blockquote__Blockquote-l1ah9g-0 jgQxbh" id="
">
<p class="paragraph__Paragraph-sc-2voub2-0 dKQhfr" id="for example:">for example:</p>
</blockquote>
<div class="gatsby-highlight div__Div-sc-1l67xj5-0 dERKfM"><pre class="language-bash pre__Pre-sc-1ql72bi-0 hEaywI"><code class="language-bash code__Code-sc-1mcw21l-0 flReVN" id="$ ">$ <span class="token function span__Span-sc-1x0bjnh-0 iZyUgN" id="mkdir">mkdir</span> /app <span class="token operator span__Span-sc-1x0bjnh-0 iZyUgN" id="&amp;&amp;">&amp;&amp;</span> <span class="token function span__Span-sc-1x0bjnh-0 iZyUgN" id="cd">cd</span> /app <span class="token operator span__Span-sc-1x0bjnh-0 iZyUgN" id="&amp;&amp;">&amp;&amp;</span> <span class="token function span__Span-sc-1x0bjnh-0 iZyUgN" id="git">git</span> init
$ <span class="token function span__Span-sc-1x0bjnh-0 iZyUgN" id="yarn">yarn</span> init -y
$ <span class="token function span__Span-sc-1x0bjnh-0 iZyUgN" id="yarn">yarn</span> <span class="token function span__Span-sc-1x0bjnh-0 iZyUgN" id="add">add</span> koa
<span class="token comment span__Span-sc-1x0bjnh-0 iZyUgN" id="# optionally, add typescript"># optionally, add typescript</span>
$ <span class="token function span__Span-sc-1x0bjnh-0 iZyUgN" id="yarn">yarn</span> <span class="token function span__Span-sc-1x0bjnh-0 iZyUgN" id="add">add</span> --dev typescript @types/koa
$ npx tsc --init
$ <span class="token function span__Span-sc-1x0bjnh-0 iZyUgN" id="touch">touch</span> index.ts</code></pre></div>
<p class="paragraph__Paragraph-sc-2voub2-0 dKQhfr" id="start a new project, and install the barebones.">start a new project, and install the barebones.</p>
<p class="paragraph__Paragraph-sc-2voub2-0 dKQhfr" id="it is assumed that you already have ">it is assumed that you already have <a target="_blank" href="https://nodejs.org" class="link__Link-umnslz-0 eFqDVI">nodejs</a> installed.
i also use <a target="_blank" href="https://yarnpkg.com" class="link__Link-umnslz-0 eFqDVI">yarn</a>, but feel free to use the package
manager of your choice (<code class="language-text code__Code-sc-1mcw21l-0 flReVN" id="npm">npm</code> is bundled with nodejs).</p>
<h1 class="heading__Heading1-sc-16djx8k-0 jfrkmZ" id="create a piece of middleware">create a piece of middleware</h1>
<blockquote class="blockquote__Blockquote-l1ah9g-0 jgQxbh" id="
">
<p class="paragraph__Paragraph-sc-2voub2-0 dKQhfr" id="a middleware is just function. let&#x27;s make one.">a middleware is just function. let&#x27;s make one.</p>
</blockquote>
<div class="gatsby-highlight div__Div-sc-1l67xj5-0 dERKfM"><pre class="language-typescript pre__Pre-sc-1ql72bi-0 hEaywI"><code class="language-typescript code__Code-sc-1mcw21l-0 flReVN"><span class="token comment span__Span-sc-1x0bjnh-0 iZyUgN" id="// babys-first-middleware/server.js">// babys-first-middleware/server.js</span>
<span class="token keyword span__Span-sc-1x0bjnh-0 iZyUgN" id="const">const</span> loggerMiddleware<span class="token punctuation span__Span-sc-1x0bjnh-0 iZyUgN" id=":">:</span> Middleware<span class="token operator span__Span-sc-1x0bjnh-0 iZyUgN" id="&lt;">&lt;</span><span class="token builtin span__Span-sc-1x0bjnh-0 iZyUgN" id="any">any</span><span class="token operator span__Span-sc-1x0bjnh-0 iZyUgN" id="&gt;">&gt;</span> <span class="token operator span__Span-sc-1x0bjnh-0 iZyUgN" id="=">=</span> <span class="token keyword span__Span-sc-1x0bjnh-0 iZyUgN" id="async">async</span> <span class="token punctuation span__Span-sc-1x0bjnh-0 iZyUgN" id="(">(</span><span class="token parameter span__Span-sc-1x0bjnh-0 iZyUgN" id="ctx">ctx<span class="token punctuation span__Span-sc-1x0bjnh-0 iZyUgN" id=",">,</span> next</span><span class="token punctuation span__Span-sc-1x0bjnh-0 iZyUgN" id=")">)</span> <span class="token operator span__Span-sc-1x0bjnh-0 iZyUgN" id="=&gt;">=&gt;</span> <span class="token punctuation span__Span-sc-1x0bjnh-0 iZyUgN" id="{">{</span>
  <span class="token builtin span__Span-sc-1x0bjnh-0 iZyUgN" id="console">console</span><span class="token punctuation span__Span-sc-1x0bjnh-0 iZyUgN" id=".">.</span><span class="token function span__Span-sc-1x0bjnh-0 iZyUgN" id="log">log</span><span class="token punctuation span__Span-sc-1x0bjnh-0 iZyUgN" id="(">(</span><span class="token string span__Span-sc-1x0bjnh-0 iZyUgN" id="&#x27;before&#x27;">&#x27;before&#x27;</span><span class="token punctuation span__Span-sc-1x0bjnh-0 iZyUgN" id=")">)</span>
  <span class="token keyword span__Span-sc-1x0bjnh-0 iZyUgN" id="await">await</span> <span class="token function span__Span-sc-1x0bjnh-0 iZyUgN" id="next">next</span><span class="token punctuation span__Span-sc-1x0bjnh-0 iZyUgN" id="(">(</span><span class="token punctuation span__Span-sc-1x0bjnh-0 iZyUgN" id=")">)</span> <span class="token comment span__Span-sc-1x0bjnh-0 iZyUgN" id="// runs the next middleware">// runs the next middleware</span>
  <span class="token builtin span__Span-sc-1x0bjnh-0 iZyUgN" id="console">console</span><span class="token punctuation span__Span-sc-1x0bjnh-0 iZyUgN" id=".">.</span><span class="token function span__Span-sc-1x0bjnh-0 iZyUgN" id="log">log</span><span class="token punctuation span__Span-sc-1x0bjnh-0 iZyUgN" id="(">(</span><span class="token string span__Span-sc-1x0bjnh-0 iZyUgN" id="&#x27;after&#x27;">&#x27;after&#x27;</span><span class="token punctuation span__Span-sc-1x0bjnh-0 iZyUgN" id=")">)</span>
<span class="token punctuation span__Span-sc-1x0bjnh-0 iZyUgN" id="}">}</span>
<span class="token comment span__Span-sc-1x0bjnh-0 iZyUgN" id="// curl localhost:3000 # logs:">// curl localhost:3000 # logs:</span>
<span class="token comment span__Span-sc-1x0bjnh-0 iZyUgN" id="// before">// before</span>
<span class="token comment span__Span-sc-1x0bjnh-0 iZyUgN" id="// after">// after</span></code></pre></div>
<blockquote class="blockquote__Blockquote-l1ah9g-0 jgQxbh" id="
">
<p class="paragraph__Paragraph-sc-2voub2-0 dKQhfr" id="typescript buff?">typescript buff?</p>
</blockquote>
<div class="gatsby-highlight div__Div-sc-1l67xj5-0 dERKfM"><pre class="language-typescript pre__Pre-sc-1ql72bi-0 hEaywI"><code class="language-typescript code__Code-sc-1mcw21l-0 flReVN"><span class="token keyword span__Span-sc-1x0bjnh-0 iZyUgN" id="type">type</span> Middleware<span class="token operator span__Span-sc-1x0bjnh-0 iZyUgN" id="&lt;">&lt;</span><span class="token constant span__Span-sc-1x0bjnh-0 iZyUgN" id="t">T</span><span class="token operator span__Span-sc-1x0bjnh-0 iZyUgN" id="&gt;">&gt;</span> <span class="token operator span__Span-sc-1x0bjnh-0 iZyUgN" id="=">=</span>
  <span class="token punctuation span__Span-sc-1x0bjnh-0 iZyUgN" id="(">(</span>context<span class="token punctuation span__Span-sc-1x0bjnh-0 iZyUgN" id=":">:</span> <span class="token constant span__Span-sc-1x0bjnh-0 iZyUgN" id="t">T</span><span class="token punctuation span__Span-sc-1x0bjnh-0 iZyUgN" id=",">,</span> <span class="token function-variable function span__Span-sc-1x0bjnh-0 iZyUgN" id="next">next</span><span class="token punctuation span__Span-sc-1x0bjnh-0 iZyUgN" id=":">:</span> <span class="token punctuation span__Span-sc-1x0bjnh-0 iZyUgN" id="(">(</span><span class="token punctuation span__Span-sc-1x0bjnh-0 iZyUgN" id=")">)</span> <span class="token operator span__Span-sc-1x0bjnh-0 iZyUgN" id="=&gt;">=&gt;</span> <span class="token builtin span__Span-sc-1x0bjnh-0 iZyUgN" id="promise">Promise</span><span class="token operator span__Span-sc-1x0bjnh-0 iZyUgN" id="&lt;">&lt;</span><span class="token builtin span__Span-sc-1x0bjnh-0 iZyUgN" id="any">any</span><span class="token operator span__Span-sc-1x0bjnh-0 iZyUgN" id="&gt;">&gt;</span><span class="token punctuation span__Span-sc-1x0bjnh-0 iZyUgN" id=")">)</span> <span class="token operator span__Span-sc-1x0bjnh-0 iZyUgN" id="=&gt;">=&gt;</span> <span class="token builtin span__Span-sc-1x0bjnh-0 iZyUgN" id="any">any</span><span class="token punctuation span__Span-sc-1x0bjnh-0 iZyUgN" id=";">;</span>

<span class="token comment span__Span-sc-1x0bjnh-0 iZyUgN" id="// don&#x27;t know typescript?  dont sweat it.">// don&#x27;t know typescript?  dont sweat it.</span>
<span class="token comment span__Span-sc-1x0bjnh-0 iZyUgN" id="// this statment says that a middleware is a function">// this statment says that a middleware is a function</span>
<span class="token comment span__Span-sc-1x0bjnh-0 iZyUgN" id="// that takes two arguments--a context,">// that takes two arguments--a context,</span>
<span class="token comment span__Span-sc-1x0bjnh-0 iZyUgN" id="// and another function called `next`">// and another function called `next`</span></code></pre></div>
<p class="paragraph__Paragraph-sc-2voub2-0 dKQhfr" id="the koa docs already cover this full well, but it&#x27;s worth a quick review.
most &quot;work&quot; in koa applications happen in middlewares.  your application exists
to do work, and a request/response ">the koa docs already cover this full well, but it&#x27;s worth a quick review.
most &quot;work&quot; in koa applications happen in middlewares.  your application exists
to do work, and a request/response <code class="language-text code__Code-sc-1mcw21l-0 flReVN" id="context">context</code> flows up and down a stack--or tree--of
middlewares.</p>
<p class="paragraph__Paragraph-sc-2voub2-0 dKQhfr" id="they&#x27;re easy to write, and should be considered often when designing a workflow.">they&#x27;re easy to write, and should be considered often when designing a workflow.</p>
<p class="paragraph__Paragraph-sc-2voub2-0 dKQhfr" id="anything passed to ">anything passed to <code class="language-text code__Code-sc-1mcw21l-0 flReVN" id="koa.use(...)">koa.use(...)</code> is a piece of middleware.</p>
<h1 class="heading__Heading1-sc-16djx8k-0 jfrkmZ" id="link middlewares together">link middlewares together</h1>
<blockquote class="blockquote__Blockquote-l1ah9g-0 jgQxbh" id="
">
<p class="paragraph__Paragraph-sc-2voub2-0 dKQhfr" id="the middleware &quot;stack&quot;">the middleware &quot;stack&quot;</p>
</blockquote>
<div class="gatsby-highlight div__Div-sc-1l67xj5-0 dERKfM"><pre class="language-typescript pre__Pre-sc-1ql72bi-0 hEaywI"><code class="language-typescript code__Code-sc-1mcw21l-0 flReVN"><span class="token comment span__Span-sc-1x0bjnh-0 iZyUgN" id="// serial-middlewares/server.ts">// serial-middlewares/server.ts</span>
<span class="token keyword span__Span-sc-1x0bjnh-0 iZyUgN" id="const">const</span> requestCounter<span class="token punctuation span__Span-sc-1x0bjnh-0 iZyUgN" id=":">:</span> <span class="token function-variable function span__Span-sc-1x0bjnh-0 iZyUgN" id="middleware">Middleware</span> <span class="token operator span__Span-sc-1x0bjnh-0 iZyUgN" id="=">=</span> <span class="token keyword span__Span-sc-1x0bjnh-0 iZyUgN" id="async">async</span> <span class="token punctuation span__Span-sc-1x0bjnh-0 iZyUgN" id="(">(</span><span class="token parameter span__Span-sc-1x0bjnh-0 iZyUgN" id="ctx">ctx<span class="token punctuation span__Span-sc-1x0bjnh-0 iZyUgN" id=",">,</span> next</span><span class="token punctuation span__Span-sc-1x0bjnh-0 iZyUgN" id=")">)</span> <span class="token operator span__Span-sc-1x0bjnh-0 iZyUgN" id="=&gt;">=&gt;</span> <span class="token punctuation span__Span-sc-1x0bjnh-0 iZyUgN" id="{">{</span>
  <span class="token operator span__Span-sc-1x0bjnh-0 iZyUgN" id="++">++</span>ctx<span class="token punctuation span__Span-sc-1x0bjnh-0 iZyUgN" id=".">.</span>serialExample<span class="token punctuation span__Span-sc-1x0bjnh-0 iZyUgN" id=".">.</span>requestCount
  <span class="token builtin span__Span-sc-1x0bjnh-0 iZyUgN" id="console">console</span><span class="token punctuation span__Span-sc-1x0bjnh-0 iZyUgN" id=".">.</span><span class="token function span__Span-sc-1x0bjnh-0 iZyUgN" id="log">log</span><span class="token punctuation span__Span-sc-1x0bjnh-0 iZyUgN" id="(">(</span><span class="token template-string span__Span-sc-1x0bjnh-0 iZyUgN"><span class="token string span__Span-sc-1x0bjnh-0 iZyUgN" id="`request #">`request #</span><span class="token interpolation span__Span-sc-1x0bjnh-0 iZyUgN"><span class="token interpolation-punctuation punctuation span__Span-sc-1x0bjnh-0 iZyUgN" id="${">${</span>ctx<span class="token punctuation span__Span-sc-1x0bjnh-0 iZyUgN" id=".">.</span>serialExample<span class="token punctuation span__Span-sc-1x0bjnh-0 iZyUgN" id=".">.</span>requestCount<span class="token interpolation-punctuation punctuation span__Span-sc-1x0bjnh-0 iZyUgN" id="}">}</span></span><span class="token string span__Span-sc-1x0bjnh-0 iZyUgN" id="\n`">\n`</span></span><span class="token punctuation span__Span-sc-1x0bjnh-0 iZyUgN" id=")">)</span>
  <span class="token keyword span__Span-sc-1x0bjnh-0 iZyUgN" id="await">await</span> <span class="token function span__Span-sc-1x0bjnh-0 iZyUgN" id="next">next</span><span class="token punctuation span__Span-sc-1x0bjnh-0 iZyUgN" id="(">(</span><span class="token punctuation span__Span-sc-1x0bjnh-0 iZyUgN" id=")">)</span>
<span class="token punctuation span__Span-sc-1x0bjnh-0 iZyUgN" id="}">}</span>
<span class="token comment span__Span-sc-1x0bjnh-0 iZyUgN" id="// ...">// ...</span>
  app<span class="token punctuation span__Span-sc-1x0bjnh-0 iZyUgN" id=".">.</span>context<span class="token punctuation span__Span-sc-1x0bjnh-0 iZyUgN" id=".">.</span>serialExample <span class="token operator span__Span-sc-1x0bjnh-0 iZyUgN" id="=">=</span> <span class="token punctuation span__Span-sc-1x0bjnh-0 iZyUgN" id="{">{</span> requestCount<span class="token punctuation span__Span-sc-1x0bjnh-0 iZyUgN" id=":">:</span> <span class="token number span__Span-sc-1x0bjnh-0 iZyUgN" id="0">0</span> <span class="token punctuation span__Span-sc-1x0bjnh-0 iZyUgN" id="}">}</span>
  app<span class="token punctuation span__Span-sc-1x0bjnh-0 iZyUgN" id=".">.</span><span class="token function span__Span-sc-1x0bjnh-0 iZyUgN" id="use">use</span><span class="token punctuation span__Span-sc-1x0bjnh-0 iZyUgN" id="(">(</span>loggerMiddleware<span class="token punctuation span__Span-sc-1x0bjnh-0 iZyUgN" id=")">)</span> <span class="token comment span__Span-sc-1x0bjnh-0 iZyUgN" id="// see prior example">// see prior example</span>
  app<span class="token punctuation span__Span-sc-1x0bjnh-0 iZyUgN" id=".">.</span><span class="token function span__Span-sc-1x0bjnh-0 iZyUgN" id="use">use</span><span class="token punctuation span__Span-sc-1x0bjnh-0 iZyUgN" id="(">(</span>requestCounter<span class="token punctuation span__Span-sc-1x0bjnh-0 iZyUgN" id=")">)</span>

<span class="token comment span__Span-sc-1x0bjnh-0 iZyUgN" id="// $ curl localhost:3000">// $ curl localhost:3000</span>
<span class="token comment span__Span-sc-1x0bjnh-0 iZyUgN" id="//   before">//   before</span>
<span class="token comment span__Span-sc-1x0bjnh-0 iZyUgN" id="//   request #1">//   request #1</span>
<span class="token comment span__Span-sc-1x0bjnh-0 iZyUgN" id="//   after">//   after</span>
<span class="token comment span__Span-sc-1x0bjnh-0 iZyUgN" id="// $ curl localhost:3000">// $ curl localhost:3000</span>
<span class="token comment span__Span-sc-1x0bjnh-0 iZyUgN" id="//   before">//   before</span>
<span class="token comment span__Span-sc-1x0bjnh-0 iZyUgN" id="//   request #2">//   request #2</span>
<span class="token comment span__Span-sc-1x0bjnh-0 iZyUgN" id="//   after">//   after</span></code></pre></div>
<p class="paragraph__Paragraph-sc-2voub2-0 dKQhfr" id="middlewares get called in the order that they are registered with ">middlewares get called in the order that they are registered with <code class="language-text code__Code-sc-1mcw21l-0 flReVN" id="app.use(...)">app.use(...)</code>.
when a middleware calls <code class="language-text code__Code-sc-1mcw21l-0 flReVN" id="next()">next()</code>, koa calls the next middleware downsteam if are any available.</p>
<h1 class="heading__Heading1-sc-16djx8k-0 jfrkmZ" id="create a basic server">create a basic server</h1>
<div class="gatsby-highlight div__Div-sc-1l67xj5-0 dERKfM"><pre class="language-typescript pre__Pre-sc-1ql72bi-0 hEaywI"><code class="language-typescript code__Code-sc-1mcw21l-0 flReVN"><span class="token comment span__Span-sc-1x0bjnh-0 iZyUgN" id="// 404/server.ts">// 404/server.ts</span>
<span class="token keyword span__Span-sc-1x0bjnh-0 iZyUgN" id="import">import</span> Koa <span class="token keyword span__Span-sc-1x0bjnh-0 iZyUgN" id="from">from</span> <span class="token string span__Span-sc-1x0bjnh-0 iZyUgN" id="&#x27;koa&#x27;">&#x27;koa&#x27;</span>
<span class="token keyword span__Span-sc-1x0bjnh-0 iZyUgN" id="async">async</span> <span class="token keyword span__Span-sc-1x0bjnh-0 iZyUgN" id="function">function</span> <span class="token function span__Span-sc-1x0bjnh-0 iZyUgN" id="start">start</span> <span class="token punctuation span__Span-sc-1x0bjnh-0 iZyUgN" id="(">(</span><span class="token punctuation span__Span-sc-1x0bjnh-0 iZyUgN" id=")">)</span> <span class="token punctuation span__Span-sc-1x0bjnh-0 iZyUgN" id="{">{</span>
  <span class="token keyword span__Span-sc-1x0bjnh-0 iZyUgN" id="const">const</span> koa <span class="token operator span__Span-sc-1x0bjnh-0 iZyUgN" id="=">=</span> <span class="token keyword span__Span-sc-1x0bjnh-0 iZyUgN" id="new">new</span> <span class="token class-name span__Span-sc-1x0bjnh-0 iZyUgN" id="koa">Koa</span><span class="token punctuation span__Span-sc-1x0bjnh-0 iZyUgN" id="(">(</span><span class="token punctuation span__Span-sc-1x0bjnh-0 iZyUgN" id=")">)</span>
  koa<span class="token punctuation span__Span-sc-1x0bjnh-0 iZyUgN" id=".">.</span><span class="token function span__Span-sc-1x0bjnh-0 iZyUgN" id="listen">listen</span><span class="token punctuation span__Span-sc-1x0bjnh-0 iZyUgN" id="(">(</span><span class="token number span__Span-sc-1x0bjnh-0 iZyUgN" id="3000">3000</span><span class="token punctuation span__Span-sc-1x0bjnh-0 iZyUgN" id=")">)</span>
<span class="token punctuation span__Span-sc-1x0bjnh-0 iZyUgN" id="}">}</span>
<span class="token function span__Span-sc-1x0bjnh-0 iZyUgN" id="start">start</span><span class="token punctuation span__Span-sc-1x0bjnh-0 iZyUgN" id="(">(</span><span class="token punctuation span__Span-sc-1x0bjnh-0 iZyUgN" id=")">)</span>
<span class="token comment span__Span-sc-1x0bjnh-0 iZyUgN" id="// curl localhost:3000 # =&gt; 404">// curl localhost:3000 # =&gt; 404</span></code></pre></div>
<p class="paragraph__Paragraph-sc-2voub2-0 dKQhfr" id="the following is a minimal koa server.  note that when you stream nothing back
to clients, the default http response is ">the following is a minimal koa server.  note that when you stream nothing back
to clients, the default http response is <code class="language-text code__Code-sc-1mcw21l-0 flReVN" id="404">404</code>.</p>
<h1 class="heading__Heading1-sc-16djx8k-0 jfrkmZ" id="create a hello world server">create a hello world server</h1>
<div class="gatsby-highlight div__Div-sc-1l67xj5-0 dERKfM"><pre class="language-typescript pre__Pre-sc-1ql72bi-0 hEaywI"><code class="language-typescript code__Code-sc-1mcw21l-0 flReVN"><span class="token comment span__Span-sc-1x0bjnh-0 iZyUgN" id="// hello-world/server.ts">// hello-world/server.ts</span>
<span class="token keyword span__Span-sc-1x0bjnh-0 iZyUgN" id="import">import</span> Koa <span class="token keyword span__Span-sc-1x0bjnh-0 iZyUgN" id="from">from</span> <span class="token string span__Span-sc-1x0bjnh-0 iZyUgN" id="&#x27;koa&#x27;">&#x27;koa&#x27;</span>
<span class="token keyword span__Span-sc-1x0bjnh-0 iZyUgN" id="async">async</span> <span class="token keyword span__Span-sc-1x0bjnh-0 iZyUgN" id="function">function</span> <span class="token function span__Span-sc-1x0bjnh-0 iZyUgN" id="start">start</span> <span class="token punctuation span__Span-sc-1x0bjnh-0 iZyUgN" id="(">(</span><span class="token punctuation span__Span-sc-1x0bjnh-0 iZyUgN" id=")">)</span> <span class="token punctuation span__Span-sc-1x0bjnh-0 iZyUgN" id="{">{</span>
  <span class="token keyword span__Span-sc-1x0bjnh-0 iZyUgN" id="const">const</span> app <span class="token operator span__Span-sc-1x0bjnh-0 iZyUgN" id="=">=</span> <span class="token keyword span__Span-sc-1x0bjnh-0 iZyUgN" id="new">new</span> <span class="token class-name span__Span-sc-1x0bjnh-0 iZyUgN" id="koa">Koa</span><span class="token punctuation span__Span-sc-1x0bjnh-0 iZyUgN" id="(">(</span><span class="token punctuation span__Span-sc-1x0bjnh-0 iZyUgN" id=")">)</span>
  app<span class="token punctuation span__Span-sc-1x0bjnh-0 iZyUgN" id=".">.</span><span class="token function span__Span-sc-1x0bjnh-0 iZyUgN" id="use">use</span><span class="token punctuation span__Span-sc-1x0bjnh-0 iZyUgN" id="(">(</span><span class="token parameter span__Span-sc-1x0bjnh-0 iZyUgN" id="ctx">ctx</span> <span class="token operator span__Span-sc-1x0bjnh-0 iZyUgN" id="=&gt;">=&gt;</span> <span class="token punctuation span__Span-sc-1x0bjnh-0 iZyUgN" id="{">{</span>
    ctx<span class="token punctuation span__Span-sc-1x0bjnh-0 iZyUgN" id=".">.</span>body <span class="token operator span__Span-sc-1x0bjnh-0 iZyUgN" id="=">=</span> <span class="token string span__Span-sc-1x0bjnh-0 iZyUgN" id="&#x27;hello world&#x27;">&#x27;hello world&#x27;</span>
  <span class="token punctuation span__Span-sc-1x0bjnh-0 iZyUgN" id="}">}</span><span class="token punctuation span__Span-sc-1x0bjnh-0 iZyUgN" id=")">)</span>
  app<span class="token punctuation span__Span-sc-1x0bjnh-0 iZyUgN" id=".">.</span><span class="token function span__Span-sc-1x0bjnh-0 iZyUgN" id="listen">listen</span><span class="token punctuation span__Span-sc-1x0bjnh-0 iZyUgN" id="(">(</span><span class="token number span__Span-sc-1x0bjnh-0 iZyUgN" id="3000">3000</span><span class="token punctuation span__Span-sc-1x0bjnh-0 iZyUgN" id=")">)</span>
<span class="token punctuation span__Span-sc-1x0bjnh-0 iZyUgN" id="}">}</span>
<span class="token function span__Span-sc-1x0bjnh-0 iZyUgN" id="start">start</span><span class="token punctuation span__Span-sc-1x0bjnh-0 iZyUgN" id="(">(</span><span class="token punctuation span__Span-sc-1x0bjnh-0 iZyUgN" id=")">)</span>
<span class="token comment span__Span-sc-1x0bjnh-0 iZyUgN" id="// curl localhost:3000 # =&gt; 200 &quot;hello world&quot;">// curl localhost:3000 # =&gt; 200 &quot;hello world&quot;</span></code></pre></div>
<p class="paragraph__Paragraph-sc-2voub2-0 dKQhfr" id="let&#x27;s register a single middleware.  the middleware considers nothing about the
details of your request--it blindly sets ">let&#x27;s register a single middleware.  the middleware considers nothing about the
details of your request--it blindly sets <code class="language-text code__Code-sc-1mcw21l-0 flReVN" id="&#x27;hello world&#x27;">&#x27;hello world&#x27;</code> to the body.</p>
<h1 class="heading__Heading1-sc-16djx8k-0 jfrkmZ" id="perform dummy routing">perform dummy routing</h1>
<p class="paragraph__Paragraph-sc-2voub2-0 dKQhfr" id="you can route manually based on request parameters all you want.  the ">you can route manually based on request parameters all you want.  the <code class="language-text code__Code-sc-1mcw21l-0 flReVN" id="ctx">ctx</code>
puts various request/response properies right on the <code class="language-text code__Code-sc-1mcw21l-0 flReVN" id="ctx">ctx</code> object.  i could have
used <code class="language-text code__Code-sc-1mcw21l-0 flReVN" id="ctx.request.path">ctx.request.path</code> as well.  <code class="language-text code__Code-sc-1mcw21l-0 flReVN" id="¯\_(ツ)_/¯">¯\_(ツ)_/¯</code>.  terse is a-o-k so long as it&#x27;s clear.</p>
<div class="gatsby-highlight div__Div-sc-1l67xj5-0 dERKfM"><pre class="language-typescript pre__Pre-sc-1ql72bi-0 hEaywI"><code class="language-typescript code__Code-sc-1mcw21l-0 flReVN"><span class="token comment span__Span-sc-1x0bjnh-0 iZyUgN" id="// dummy-routing/server.ts">// dummy-routing/server.ts</span>
app<span class="token punctuation span__Span-sc-1x0bjnh-0 iZyUgN" id=".">.</span><span class="token function span__Span-sc-1x0bjnh-0 iZyUgN" id="use">use</span><span class="token punctuation span__Span-sc-1x0bjnh-0 iZyUgN" id="(">(</span><span class="token parameter span__Span-sc-1x0bjnh-0 iZyUgN" id="ctx">ctx</span> <span class="token operator span__Span-sc-1x0bjnh-0 iZyUgN" id="=&gt;">=&gt;</span> <span class="token punctuation span__Span-sc-1x0bjnh-0 iZyUgN" id="{">{</span>
  <span class="token keyword span__Span-sc-1x0bjnh-0 iZyUgN" id="if">if</span> <span class="token punctuation span__Span-sc-1x0bjnh-0 iZyUgN" id="(">(</span>ctx<span class="token punctuation span__Span-sc-1x0bjnh-0 iZyUgN" id=".">.</span>path <span class="token operator span__Span-sc-1x0bjnh-0 iZyUgN" id="===">===</span> <span class="token string span__Span-sc-1x0bjnh-0 iZyUgN" id="&#x27;/hello&#x27;">&#x27;/hello&#x27;</span> <span class="token operator span__Span-sc-1x0bjnh-0 iZyUgN" id="&amp;&amp;">&amp;&amp;</span> ctx<span class="token punctuation span__Span-sc-1x0bjnh-0 iZyUgN" id=".">.</span>method <span class="token operator span__Span-sc-1x0bjnh-0 iZyUgN" id="===">===</span> <span class="token string span__Span-sc-1x0bjnh-0 iZyUgN" id="&#x27;get&#x27;">&#x27;GET&#x27;</span><span class="token punctuation span__Span-sc-1x0bjnh-0 iZyUgN" id=")">)</span> <span class="token punctuation span__Span-sc-1x0bjnh-0 iZyUgN" id="{">{</span>
    <span class="token keyword span__Span-sc-1x0bjnh-0 iZyUgN" id="return">return</span> ctx<span class="token punctuation span__Span-sc-1x0bjnh-0 iZyUgN" id=".">.</span>body <span class="token operator span__Span-sc-1x0bjnh-0 iZyUgN" id="=">=</span> <span class="token string span__Span-sc-1x0bjnh-0 iZyUgN" id="&#x27;world&#x27;">&#x27;world&#x27;</span>
  <span class="token punctuation span__Span-sc-1x0bjnh-0 iZyUgN" id="}">}</span>
  <span class="token keyword span__Span-sc-1x0bjnh-0 iZyUgN" id="if">if</span> <span class="token punctuation span__Span-sc-1x0bjnh-0 iZyUgN" id="(">(</span>ctx<span class="token punctuation span__Span-sc-1x0bjnh-0 iZyUgN" id=".">.</span>path <span class="token operator span__Span-sc-1x0bjnh-0 iZyUgN" id="===">===</span> <span class="token string span__Span-sc-1x0bjnh-0 iZyUgN" id="&#x27;/beep&#x27;">&#x27;/beep&#x27;</span> <span class="token operator span__Span-sc-1x0bjnh-0 iZyUgN" id="&amp;&amp;">&amp;&amp;</span> ctx<span class="token punctuation span__Span-sc-1x0bjnh-0 iZyUgN" id=".">.</span>method <span class="token operator span__Span-sc-1x0bjnh-0 iZyUgN" id="===">===</span> <span class="token string span__Span-sc-1x0bjnh-0 iZyUgN" id="&#x27;post&#x27;">&#x27;POST&#x27;</span><span class="token punctuation span__Span-sc-1x0bjnh-0 iZyUgN" id=")">)</span> <span class="token punctuation span__Span-sc-1x0bjnh-0 iZyUgN" id="{">{</span>
    <span class="token builtin span__Span-sc-1x0bjnh-0 iZyUgN" id="console">console</span><span class="token punctuation span__Span-sc-1x0bjnh-0 iZyUgN" id=".">.</span><span class="token function span__Span-sc-1x0bjnh-0 iZyUgN" id="log">log</span><span class="token punctuation span__Span-sc-1x0bjnh-0 iZyUgN" id="(">(</span><span class="token string span__Span-sc-1x0bjnh-0 iZyUgN" id="&#x27;bop&#x27;">&#x27;bop&#x27;</span><span class="token punctuation span__Span-sc-1x0bjnh-0 iZyUgN" id=")">)</span>
  <span class="token punctuation span__Span-sc-1x0bjnh-0 iZyUgN" id="}">}</span>
<span class="token punctuation span__Span-sc-1x0bjnh-0 iZyUgN" id="}">}</span><span class="token punctuation span__Span-sc-1x0bjnh-0 iZyUgN" id=")">)</span>
<span class="token comment span__Span-sc-1x0bjnh-0 iZyUgN" id="// curl localhost:3000/hello # =&gt; 200 &quot;world&quot;">// curl localhost:3000/hello # =&gt; 200 &quot;world&quot;</span>
<span class="token comment span__Span-sc-1x0bjnh-0 iZyUgN" id="// curl -x post localhost:3000/beep # logs &quot;bop&quot;">// curl -X POST localhost:3000/beep # logs &quot;bop&quot;</span></code></pre></div>
<h1 class="heading__Heading1-sc-16djx8k-0 jfrkmZ" id="perform basic routing">perform basic routing</h1>
<p class="paragraph__Paragraph-sc-2voub2-0 dKQhfr"><a target="_blank" href="https://github.com/ZijianHe/koa-router" class="link__Link-umnslz-0 eFqDVI">koa-router</a> is the defact router for koa.</p>
<p class="paragraph__Paragraph-sc-2voub2-0 dKQhfr" id="define some routes, then use ">define some routes, then use <code class="language-text code__Code-sc-1mcw21l-0 flReVN" id=".routes()">.routes()</code> to create a middleware on the router, which
you can then plug into your app.</p>
<div class="gatsby-highlight div__Div-sc-1l67xj5-0 dERKfM"><pre class="language-typescript pre__Pre-sc-1ql72bi-0 hEaywI"><code class="language-typescript code__Code-sc-1mcw21l-0 flReVN"><span class="token keyword span__Span-sc-1x0bjnh-0 iZyUgN" id="import">import</span> Router <span class="token keyword span__Span-sc-1x0bjnh-0 iZyUgN" id="from">from</span> <span class="token string span__Span-sc-1x0bjnh-0 iZyUgN" id="&#x27;koa-router&#x27;">&#x27;koa-router&#x27;</span>
<span class="token comment span__Span-sc-1x0bjnh-0 iZyUgN" id="// ...">// ...</span>
<span class="token keyword span__Span-sc-1x0bjnh-0 iZyUgN" id="const">const</span> app <span class="token operator span__Span-sc-1x0bjnh-0 iZyUgN" id="=">=</span> <span class="token keyword span__Span-sc-1x0bjnh-0 iZyUgN" id="new">new</span> <span class="token class-name span__Span-sc-1x0bjnh-0 iZyUgN" id="koa">Koa</span><span class="token punctuation span__Span-sc-1x0bjnh-0 iZyUgN" id="(">(</span><span class="token punctuation span__Span-sc-1x0bjnh-0 iZyUgN" id=")">)</span>
<span class="token keyword span__Span-sc-1x0bjnh-0 iZyUgN" id="var">var</span> router <span class="token operator span__Span-sc-1x0bjnh-0 iZyUgN" id="=">=</span> <span class="token keyword span__Span-sc-1x0bjnh-0 iZyUgN" id="new">new</span> <span class="token class-name span__Span-sc-1x0bjnh-0 iZyUgN" id="router">Router</span><span class="token punctuation span__Span-sc-1x0bjnh-0 iZyUgN" id="(">(</span><span class="token punctuation span__Span-sc-1x0bjnh-0 iZyUgN" id=")">)</span><span class="token punctuation span__Span-sc-1x0bjnh-0 iZyUgN" id=";">;</span>
router<span class="token punctuation span__Span-sc-1x0bjnh-0 iZyUgN" id=".">.</span><span class="token keyword span__Span-sc-1x0bjnh-0 iZyUgN" id="get">get</span><span class="token punctuation span__Span-sc-1x0bjnh-0 iZyUgN" id="(">(</span><span class="token string span__Span-sc-1x0bjnh-0 iZyUgN" id="&#x27;/hello&#x27;">&#x27;/hello&#x27;</span><span class="token punctuation span__Span-sc-1x0bjnh-0 iZyUgN" id=",">,</span> <span class="token parameter span__Span-sc-1x0bjnh-0 iZyUgN" id="ctx">ctx</span> <span class="token operator span__Span-sc-1x0bjnh-0 iZyUgN" id="=&gt;">=&gt;</span> ctx<span class="token punctuation span__Span-sc-1x0bjnh-0 iZyUgN" id=".">.</span>body <span class="token operator span__Span-sc-1x0bjnh-0 iZyUgN" id="=">=</span> <span class="token string span__Span-sc-1x0bjnh-0 iZyUgN" id="&#x27;world&#x27;">&#x27;world&#x27;</span><span class="token punctuation span__Span-sc-1x0bjnh-0 iZyUgN" id=")">)</span>
router<span class="token punctuation span__Span-sc-1x0bjnh-0 iZyUgN" id=".">.</span><span class="token function span__Span-sc-1x0bjnh-0 iZyUgN" id="post">post</span><span class="token punctuation span__Span-sc-1x0bjnh-0 iZyUgN" id="(">(</span><span class="token string span__Span-sc-1x0bjnh-0 iZyUgN" id="&#x27;/beep&#x27;">&#x27;/beep&#x27;</span><span class="token punctuation span__Span-sc-1x0bjnh-0 iZyUgN" id=",">,</span> <span class="token punctuation span__Span-sc-1x0bjnh-0 iZyUgN" id="(">(</span><span class="token punctuation span__Span-sc-1x0bjnh-0 iZyUgN" id=")">)</span> <span class="token operator span__Span-sc-1x0bjnh-0 iZyUgN" id="=&gt;">=&gt;</span> <span class="token builtin span__Span-sc-1x0bjnh-0 iZyUgN" id="console">console</span><span class="token punctuation span__Span-sc-1x0bjnh-0 iZyUgN" id=".">.</span><span class="token function span__Span-sc-1x0bjnh-0 iZyUgN" id="log">log</span><span class="token punctuation span__Span-sc-1x0bjnh-0 iZyUgN" id="(">(</span><span class="token string span__Span-sc-1x0bjnh-0 iZyUgN" id="&#x27;bop&#x27;">&#x27;bop&#x27;</span><span class="token punctuation span__Span-sc-1x0bjnh-0 iZyUgN" id=")">)</span><span class="token punctuation span__Span-sc-1x0bjnh-0 iZyUgN" id=")">)</span>
app<span class="token punctuation span__Span-sc-1x0bjnh-0 iZyUgN" id=".">.</span><span class="token function span__Span-sc-1x0bjnh-0 iZyUgN" id="use">use</span><span class="token punctuation span__Span-sc-1x0bjnh-0 iZyUgN" id="(">(</span>router<span class="token punctuation span__Span-sc-1x0bjnh-0 iZyUgN" id=".">.</span><span class="token function span__Span-sc-1x0bjnh-0 iZyUgN" id="routes">routes</span><span class="token punctuation span__Span-sc-1x0bjnh-0 iZyUgN" id="(">(</span><span class="token punctuation span__Span-sc-1x0bjnh-0 iZyUgN" id=")">)</span><span class="token punctuation span__Span-sc-1x0bjnh-0 iZyUgN" id=")">)</span>
<span class="token comment span__Span-sc-1x0bjnh-0 iZyUgN" id="// curl localhost:3000/hello # =&gt; &quot;world&quot;">// curl localhost:3000/hello # =&gt; &quot;world&quot;</span>
<span class="token comment span__Span-sc-1x0bjnh-0 iZyUgN" id="// curl -x post localhost:3000/beep # =&gt; 404, logs &quot;bop&quot;">// curl -X POST localhost:3000/beep # =&gt; 404, logs &quot;bop&quot;</span>
app<span class="token punctuation span__Span-sc-1x0bjnh-0 iZyUgN" id=".">.</span><span class="token function span__Span-sc-1x0bjnh-0 iZyUgN" id="listen">listen</span><span class="token punctuation span__Span-sc-1x0bjnh-0 iZyUgN" id="(">(</span><span class="token number span__Span-sc-1x0bjnh-0 iZyUgN" id="3000">3000</span><span class="token punctuation span__Span-sc-1x0bjnh-0 iZyUgN" id=")">)</span></code></pre></div>
<h1 class="heading__Heading1-sc-16djx8k-0 jfrkmZ" id="manage configuration">manage configuration</h1>
<blockquote class="blockquote__Blockquote-l1ah9g-0 jgQxbh" id="
">
<p class="paragraph__Paragraph-sc-2voub2-0 dKQhfr" id="create application config, pass it in">create application config, pass it in</p>
</blockquote>
<div class="gatsby-highlight div__Div-sc-1l67xj5-0 dERKfM"><pre class="language-typescript pre__Pre-sc-1ql72bi-0 hEaywI"><code class="language-typescript code__Code-sc-1mcw21l-0 flReVN"><span class="token comment span__Span-sc-1x0bjnh-0 iZyUgN" id="// application-config/server.ts">// application-config/server.ts</span>
<span class="token keyword span__Span-sc-1x0bjnh-0 iZyUgN" id="require">require</span><span class="token punctuation span__Span-sc-1x0bjnh-0 iZyUgN" id="(">(</span><span class="token string span__Span-sc-1x0bjnh-0 iZyUgN" id="&#x27;perish&#x27;">&#x27;perish&#x27;</span><span class="token punctuation span__Span-sc-1x0bjnh-0 iZyUgN" id=")">)</span>
<span class="token keyword span__Span-sc-1x0bjnh-0 iZyUgN" id="import">import</span> <span class="token punctuation span__Span-sc-1x0bjnh-0 iZyUgN" id="{">{</span> create <span class="token keyword span__Span-sc-1x0bjnh-0 iZyUgN" id="as">as</span> createConfig<span class="token punctuation span__Span-sc-1x0bjnh-0 iZyUgN" id=",">,</span> fromEnv <span class="token punctuation span__Span-sc-1x0bjnh-0 iZyUgN" id="}">}</span> <span class="token keyword span__Span-sc-1x0bjnh-0 iZyUgN" id="from">from</span> <span class="token string span__Span-sc-1x0bjnh-0 iZyUgN" id="&#x27;./config&#x27;">&#x27;./config&#x27;</span>
<span class="token keyword span__Span-sc-1x0bjnh-0 iZyUgN" id="import">import</span> Koa <span class="token keyword span__Span-sc-1x0bjnh-0 iZyUgN" id="from">from</span> <span class="token string span__Span-sc-1x0bjnh-0 iZyUgN" id="&#x27;koa&#x27;">&#x27;koa&#x27;</span>
<span class="token keyword span__Span-sc-1x0bjnh-0 iZyUgN" id="async">async</span> <span class="token keyword span__Span-sc-1x0bjnh-0 iZyUgN" id="function">function</span> <span class="token function span__Span-sc-1x0bjnh-0 iZyUgN" id="start">start</span> <span class="token punctuation span__Span-sc-1x0bjnh-0 iZyUgN" id="(">(</span><span class="token punctuation span__Span-sc-1x0bjnh-0 iZyUgN" id=")">)</span> <span class="token punctuation span__Span-sc-1x0bjnh-0 iZyUgN" id="{">{</span>
  <span class="token keyword span__Span-sc-1x0bjnh-0 iZyUgN" id="const">const</span> app <span class="token operator span__Span-sc-1x0bjnh-0 iZyUgN" id="=">=</span> <span class="token keyword span__Span-sc-1x0bjnh-0 iZyUgN" id="new">new</span> <span class="token class-name span__Span-sc-1x0bjnh-0 iZyUgN" id="koa">Koa</span><span class="token punctuation span__Span-sc-1x0bjnh-0 iZyUgN" id="(">(</span><span class="token punctuation span__Span-sc-1x0bjnh-0 iZyUgN" id=")">)</span>
  <span class="token keyword span__Span-sc-1x0bjnh-0 iZyUgN" id="const">const</span> config <span class="token operator span__Span-sc-1x0bjnh-0 iZyUgN" id="=">=</span> <span class="token function span__Span-sc-1x0bjnh-0 iZyUgN" id="createconfig">createConfig</span><span class="token punctuation span__Span-sc-1x0bjnh-0 iZyUgN" id="(">(</span><span class="token function span__Span-sc-1x0bjnh-0 iZyUgN" id="fromenv">fromEnv</span><span class="token punctuation span__Span-sc-1x0bjnh-0 iZyUgN" id="(">(</span><span class="token punctuation span__Span-sc-1x0bjnh-0 iZyUgN" id=")">)</span><span class="token punctuation span__Span-sc-1x0bjnh-0 iZyUgN" id=")">)</span>
  <span class="token comment span__Span-sc-1x0bjnh-0 iZyUgN" id="// createmiddlewares(config)">// createMiddlewares(config)</span>
  <span class="token comment span__Span-sc-1x0bjnh-0 iZyUgN" id="// createservices({ app, config: config.services })">// createServices({ app, config: config.services })</span>
  <span class="token builtin span__Span-sc-1x0bjnh-0 iZyUgN" id="console">console</span><span class="token punctuation span__Span-sc-1x0bjnh-0 iZyUgN" id=".">.</span><span class="token function span__Span-sc-1x0bjnh-0 iZyUgN" id="log">log</span><span class="token punctuation span__Span-sc-1x0bjnh-0 iZyUgN" id="(">(</span><span class="token punctuation span__Span-sc-1x0bjnh-0 iZyUgN" id="{">{</span> config <span class="token punctuation span__Span-sc-1x0bjnh-0 iZyUgN" id="}">}</span><span class="token punctuation span__Span-sc-1x0bjnh-0 iZyUgN" id=")">)</span>
  app<span class="token punctuation span__Span-sc-1x0bjnh-0 iZyUgN" id=".">.</span><span class="token function span__Span-sc-1x0bjnh-0 iZyUgN" id="listen">listen</span><span class="token punctuation span__Span-sc-1x0bjnh-0 iZyUgN" id="(">(</span>config<span class="token punctuation span__Span-sc-1x0bjnh-0 iZyUgN" id=".">.</span>port<span class="token punctuation span__Span-sc-1x0bjnh-0 iZyUgN" id=")">)</span>
<span class="token punctuation span__Span-sc-1x0bjnh-0 iZyUgN" id="}">}</span>
<span class="token function span__Span-sc-1x0bjnh-0 iZyUgN" id="start">start</span><span class="token punctuation span__Span-sc-1x0bjnh-0 iZyUgN" id="(">(</span><span class="token punctuation span__Span-sc-1x0bjnh-0 iZyUgN" id=")">)</span>


<span class="token comment span__Span-sc-1x0bjnh-0 iZyUgN" id="// application-config/config.ts">// application-config/config.ts</span>
<span class="token keyword span__Span-sc-1x0bjnh-0 iZyUgN" id="import">import</span> joi <span class="token keyword span__Span-sc-1x0bjnh-0 iZyUgN" id="from">from</span> <span class="token string span__Span-sc-1x0bjnh-0 iZyUgN" id="&#x27;joi&#x27;">&#x27;joi&#x27;</span>

<span class="token keyword span__Span-sc-1x0bjnh-0 iZyUgN" id="type">type</span> Config <span class="token operator span__Span-sc-1x0bjnh-0 iZyUgN" id="=">=</span> <span class="token punctuation span__Span-sc-1x0bjnh-0 iZyUgN" id="{">{</span>
  port<span class="token punctuation span__Span-sc-1x0bjnh-0 iZyUgN" id=":">:</span> <span class="token builtin span__Span-sc-1x0bjnh-0 iZyUgN" id="number">number</span>
  logLevel<span class="token punctuation span__Span-sc-1x0bjnh-0 iZyUgN" id=":">:</span> <span class="token string span__Span-sc-1x0bjnh-0 iZyUgN" id="&#x27;debug&#x27;">&#x27;debug&#x27;</span> <span class="token operator span__Span-sc-1x0bjnh-0 iZyUgN" id="|">|</span> <span class="token string span__Span-sc-1x0bjnh-0 iZyUgN" id="&#x27;info&#x27;">&#x27;info&#x27;</span> <span class="token operator span__Span-sc-1x0bjnh-0 iZyUgN" id="|">|</span> <span class="token string span__Span-sc-1x0bjnh-0 iZyUgN" id="&#x27;warn&#x27;">&#x27;warn&#x27;</span> <span class="token operator span__Span-sc-1x0bjnh-0 iZyUgN" id="|">|</span> <span class="token string span__Span-sc-1x0bjnh-0 iZyUgN" id="&#x27;error&#x27;">&#x27;error&#x27;</span> <span class="token operator span__Span-sc-1x0bjnh-0 iZyUgN" id="|">|</span> <span class="token string span__Span-sc-1x0bjnh-0 iZyUgN" id="&#x27;silent&#x27;">&#x27;silent&#x27;</span>
<span class="token punctuation span__Span-sc-1x0bjnh-0 iZyUgN" id="}">}</span>

<span class="token keyword span__Span-sc-1x0bjnh-0 iZyUgN" id="export">export</span> <span class="token keyword span__Span-sc-1x0bjnh-0 iZyUgN" id="const">const</span> <span class="token function-variable function span__Span-sc-1x0bjnh-0 iZyUgN" id="fromenv">fromEnv</span><span class="token punctuation span__Span-sc-1x0bjnh-0 iZyUgN" id=":">:</span> <span class="token punctuation span__Span-sc-1x0bjnh-0 iZyUgN" id="(">(</span><span class="token punctuation span__Span-sc-1x0bjnh-0 iZyUgN" id=")">)</span> <span class="token operator span__Span-sc-1x0bjnh-0 iZyUgN" id="=&gt;">=&gt;</span> Partial<span class="token operator span__Span-sc-1x0bjnh-0 iZyUgN" id="&lt;">&lt;</span>Config<span class="token operator span__Span-sc-1x0bjnh-0 iZyUgN" id="&gt;">&gt;</span> <span class="token operator span__Span-sc-1x0bjnh-0 iZyUgN" id="=">=</span> <span class="token punctuation span__Span-sc-1x0bjnh-0 iZyUgN" id="(">(</span><span class="token punctuation span__Span-sc-1x0bjnh-0 iZyUgN" id=")">)</span> <span class="token operator span__Span-sc-1x0bjnh-0 iZyUgN" id="=&gt;">=&gt;</span> <span class="token punctuation span__Span-sc-1x0bjnh-0 iZyUgN" id="{">{</span>
  <span class="token keyword span__Span-sc-1x0bjnh-0 iZyUgN" id="const">const</span> partialConfig<span class="token punctuation span__Span-sc-1x0bjnh-0 iZyUgN" id=":">:</span> Partial<span class="token operator span__Span-sc-1x0bjnh-0 iZyUgN" id="&lt;">&lt;</span>Config<span class="token operator span__Span-sc-1x0bjnh-0 iZyUgN" id="&gt;">&gt;</span> <span class="token operator span__Span-sc-1x0bjnh-0 iZyUgN" id="=">=</span> <span class="token punctuation span__Span-sc-1x0bjnh-0 iZyUgN" id="{">{</span><span class="token punctuation span__Span-sc-1x0bjnh-0 iZyUgN" id="}">}</span><span class="token punctuation span__Span-sc-1x0bjnh-0 iZyUgN" id=";">;</span>
  <span class="token keyword span__Span-sc-1x0bjnh-0 iZyUgN" id="if">if</span> <span class="token punctuation span__Span-sc-1x0bjnh-0 iZyUgN" id="(">(</span>process<span class="token punctuation span__Span-sc-1x0bjnh-0 iZyUgN" id=".">.</span>env<span class="token punctuation span__Span-sc-1x0bjnh-0 iZyUgN" id=".">.</span><span class="token constant span__Span-sc-1x0bjnh-0 iZyUgN" id="port">PORT</span><span class="token punctuation span__Span-sc-1x0bjnh-0 iZyUgN" id=")">)</span> partialConfig<span class="token punctuation span__Span-sc-1x0bjnh-0 iZyUgN" id=".">.</span>port <span class="token operator span__Span-sc-1x0bjnh-0 iZyUgN" id="=">=</span> <span class="token function span__Span-sc-1x0bjnh-0 iZyUgN" id="parseint">parseInt</span><span class="token punctuation span__Span-sc-1x0bjnh-0 iZyUgN" id="(">(</span>process<span class="token punctuation span__Span-sc-1x0bjnh-0 iZyUgN" id=".">.</span>env<span class="token punctuation span__Span-sc-1x0bjnh-0 iZyUgN" id=".">.</span><span class="token constant span__Span-sc-1x0bjnh-0 iZyUgN" id="port">PORT</span><span class="token punctuation span__Span-sc-1x0bjnh-0 iZyUgN" id=")">)</span>
  <span class="token keyword span__Span-sc-1x0bjnh-0 iZyUgN" id="if">if</span> <span class="token punctuation span__Span-sc-1x0bjnh-0 iZyUgN" id="(">(</span>process<span class="token punctuation span__Span-sc-1x0bjnh-0 iZyUgN" id=".">.</span>env<span class="token punctuation span__Span-sc-1x0bjnh-0 iZyUgN" id=".">.</span><span class="token constant span__Span-sc-1x0bjnh-0 iZyUgN" id="log_level">LOG_LEVEL</span><span class="token punctuation span__Span-sc-1x0bjnh-0 iZyUgN" id=")">)</span> partialConfig<span class="token punctuation span__Span-sc-1x0bjnh-0 iZyUgN" id=".">.</span>logLevel <span class="token operator span__Span-sc-1x0bjnh-0 iZyUgN" id="=">=</span> process<span class="token punctuation span__Span-sc-1x0bjnh-0 iZyUgN" id=".">.</span>env<span class="token punctuation span__Span-sc-1x0bjnh-0 iZyUgN" id=".">.</span><span class="token constant span__Span-sc-1x0bjnh-0 iZyUgN" id="log_level">LOG_LEVEL</span> <span class="token keyword span__Span-sc-1x0bjnh-0 iZyUgN" id="as">as</span> <span class="token builtin span__Span-sc-1x0bjnh-0 iZyUgN" id="any">any</span>
  <span class="token keyword span__Span-sc-1x0bjnh-0 iZyUgN" id="return">return</span> partialConfig
<span class="token punctuation span__Span-sc-1x0bjnh-0 iZyUgN" id="}">}</span>

<span class="token comment span__Span-sc-1x0bjnh-0 iZyUgN" id="// good">// GOOD</span>
<span class="token keyword span__Span-sc-1x0bjnh-0 iZyUgN" id="export">export</span> <span class="token keyword span__Span-sc-1x0bjnh-0 iZyUgN" id="const">const</span> <span class="token function-variable function span__Span-sc-1x0bjnh-0 iZyUgN" id="create">create</span><span class="token punctuation span__Span-sc-1x0bjnh-0 iZyUgN" id=":">:</span> <span class="token punctuation span__Span-sc-1x0bjnh-0 iZyUgN" id="(">(</span><span class="token parameter span__Span-sc-1x0bjnh-0 iZyUgN" id="partial">partial<span class="token operator span__Span-sc-1x0bjnh-0 iZyUgN" id="?">?</span><span class="token punctuation span__Span-sc-1x0bjnh-0 iZyUgN" id=":">:</span> Partial<span class="token operator span__Span-sc-1x0bjnh-0 iZyUgN" id="&lt;">&lt;</span>Config<span class="token operator span__Span-sc-1x0bjnh-0 iZyUgN" id="&gt;">&gt;</span></span><span class="token punctuation span__Span-sc-1x0bjnh-0 iZyUgN" id=")">)</span> <span class="token operator span__Span-sc-1x0bjnh-0 iZyUgN" id="=&gt;">=&gt;</span> <span class="token function-variable function span__Span-sc-1x0bjnh-0 iZyUgN" id="config">Config</span> <span class="token operator span__Span-sc-1x0bjnh-0 iZyUgN" id="=">=</span> <span class="token punctuation span__Span-sc-1x0bjnh-0 iZyUgN" id="(">(</span><span class="token parameter span__Span-sc-1x0bjnh-0 iZyUgN" id="partial ">partial <span class="token operator span__Span-sc-1x0bjnh-0 iZyUgN" id="=">=</span> <span class="token punctuation span__Span-sc-1x0bjnh-0 iZyUgN" id="{">{</span><span class="token punctuation span__Span-sc-1x0bjnh-0 iZyUgN" id="}">}</span></span><span class="token punctuation span__Span-sc-1x0bjnh-0 iZyUgN" id=")">)</span> <span class="token operator span__Span-sc-1x0bjnh-0 iZyUgN" id="=&gt;">=&gt;</span> <span class="token punctuation span__Span-sc-1x0bjnh-0 iZyUgN" id="{">{</span>
  <span class="token comment span__Span-sc-1x0bjnh-0 iZyUgN" id="// create a complete configuration container, provide universally applicable">// create a complete configuration container, provide universally applicable</span>
  <span class="token comment span__Span-sc-1x0bjnh-0 iZyUgN" id="// defaults">// defaults</span>
  <span class="token keyword span__Span-sc-1x0bjnh-0 iZyUgN" id="const">const</span> <span class="token punctuation span__Span-sc-1x0bjnh-0 iZyUgN" id="{">{</span> port<span class="token punctuation span__Span-sc-1x0bjnh-0 iZyUgN" id=",">,</span> logLevel <span class="token punctuation span__Span-sc-1x0bjnh-0 iZyUgN" id="}">}</span> <span class="token operator span__Span-sc-1x0bjnh-0 iZyUgN" id="=">=</span> partial
  <span class="token keyword span__Span-sc-1x0bjnh-0 iZyUgN" id="const">const</span> config<span class="token punctuation span__Span-sc-1x0bjnh-0 iZyUgN" id=":">:</span> Config <span class="token operator span__Span-sc-1x0bjnh-0 iZyUgN" id="=">=</span> <span class="token punctuation span__Span-sc-1x0bjnh-0 iZyUgN" id="{">{</span>
    port<span class="token punctuation span__Span-sc-1x0bjnh-0 iZyUgN" id=":">:</span> port <span class="token operator span__Span-sc-1x0bjnh-0 iZyUgN" id="||">||</span> <span class="token number span__Span-sc-1x0bjnh-0 iZyUgN" id="8080">8080</span><span class="token punctuation span__Span-sc-1x0bjnh-0 iZyUgN" id=",">,</span>
    logLevel<span class="token punctuation span__Span-sc-1x0bjnh-0 iZyUgN" id=":">:</span> logLevel <span class="token operator span__Span-sc-1x0bjnh-0 iZyUgN" id="||">||</span> <span class="token string span__Span-sc-1x0bjnh-0 iZyUgN" id="&#x27;warn&#x27;">&#x27;warn&#x27;</span>
  <span class="token punctuation span__Span-sc-1x0bjnh-0 iZyUgN" id="}">}</span>
  <span class="token function span__Span-sc-1x0bjnh-0 iZyUgN" id="validate">validate</span><span class="token punctuation span__Span-sc-1x0bjnh-0 iZyUgN" id="(">(</span>config<span class="token punctuation span__Span-sc-1x0bjnh-0 iZyUgN" id=")">)</span>
  <span class="token keyword span__Span-sc-1x0bjnh-0 iZyUgN" id="return">return</span> config
<span class="token punctuation span__Span-sc-1x0bjnh-0 iZyUgN" id="}">}</span>

<span class="token keyword span__Span-sc-1x0bjnh-0 iZyUgN" id="export">export</span> <span class="token keyword span__Span-sc-1x0bjnh-0 iZyUgN" id="const">const</span> <span class="token function-variable function span__Span-sc-1x0bjnh-0 iZyUgN" id="validate">validate</span> <span class="token operator span__Span-sc-1x0bjnh-0 iZyUgN" id="=">=</span> <span class="token punctuation span__Span-sc-1x0bjnh-0 iZyUgN" id="(">(</span><span class="token parameter span__Span-sc-1x0bjnh-0 iZyUgN" id="config">config<span class="token punctuation span__Span-sc-1x0bjnh-0 iZyUgN" id=":">:</span> Config</span><span class="token punctuation span__Span-sc-1x0bjnh-0 iZyUgN" id=")">)</span> <span class="token operator span__Span-sc-1x0bjnh-0 iZyUgN" id="=&gt;">=&gt;</span> <span class="token punctuation span__Span-sc-1x0bjnh-0 iZyUgN" id="{">{</span>
  <span class="token keyword span__Span-sc-1x0bjnh-0 iZyUgN" id="const">const</span> res <span class="token operator span__Span-sc-1x0bjnh-0 iZyUgN" id="=">=</span> joi<span class="token punctuation span__Span-sc-1x0bjnh-0 iZyUgN" id=".">.</span><span class="token function span__Span-sc-1x0bjnh-0 iZyUgN" id="validate">validate</span><span class="token punctuation span__Span-sc-1x0bjnh-0 iZyUgN" id="(">(</span>config<span class="token punctuation span__Span-sc-1x0bjnh-0 iZyUgN" id=",">,</span> <span class="token punctuation span__Span-sc-1x0bjnh-0 iZyUgN" id="{">{</span>
    port<span class="token punctuation span__Span-sc-1x0bjnh-0 iZyUgN" id=":">:</span> joi<span class="token punctuation span__Span-sc-1x0bjnh-0 iZyUgN" id=".">.</span><span class="token function span__Span-sc-1x0bjnh-0 iZyUgN" id="number">number</span><span class="token punctuation span__Span-sc-1x0bjnh-0 iZyUgN" id="(">(</span><span class="token punctuation span__Span-sc-1x0bjnh-0 iZyUgN" id=")">)</span><span class="token punctuation span__Span-sc-1x0bjnh-0 iZyUgN" id=".">.</span><span class="token function span__Span-sc-1x0bjnh-0 iZyUgN" id="min">min</span><span class="token punctuation span__Span-sc-1x0bjnh-0 iZyUgN" id="(">(</span><span class="token number span__Span-sc-1x0bjnh-0 iZyUgN" id="0">0</span><span class="token punctuation span__Span-sc-1x0bjnh-0 iZyUgN" id=")">)</span><span class="token punctuation span__Span-sc-1x0bjnh-0 iZyUgN" id=",">,</span>
    logLevel<span class="token punctuation span__Span-sc-1x0bjnh-0 iZyUgN" id=":">:</span> joi<span class="token punctuation span__Span-sc-1x0bjnh-0 iZyUgN" id=".">.</span><span class="token function span__Span-sc-1x0bjnh-0 iZyUgN" id="any">any</span><span class="token punctuation span__Span-sc-1x0bjnh-0 iZyUgN" id="(">(</span><span class="token punctuation span__Span-sc-1x0bjnh-0 iZyUgN" id=")">)</span><span class="token punctuation span__Span-sc-1x0bjnh-0 iZyUgN" id=".">.</span><span class="token function span__Span-sc-1x0bjnh-0 iZyUgN" id="valid">valid</span><span class="token punctuation span__Span-sc-1x0bjnh-0 iZyUgN" id="(">(</span><span class="token string span__Span-sc-1x0bjnh-0 iZyUgN" id="&#x27;debug&#x27;">&#x27;debug&#x27;</span><span class="token punctuation span__Span-sc-1x0bjnh-0 iZyUgN" id=",">,</span> <span class="token string span__Span-sc-1x0bjnh-0 iZyUgN" id="&#x27;info&#x27;">&#x27;info&#x27;</span><span class="token punctuation span__Span-sc-1x0bjnh-0 iZyUgN" id=",">,</span> <span class="token string span__Span-sc-1x0bjnh-0 iZyUgN" id="&#x27;warn&#x27;">&#x27;warn&#x27;</span><span class="token punctuation span__Span-sc-1x0bjnh-0 iZyUgN" id=",">,</span> <span class="token string span__Span-sc-1x0bjnh-0 iZyUgN" id="&#x27;error&#x27;">&#x27;error&#x27;</span><span class="token punctuation span__Span-sc-1x0bjnh-0 iZyUgN" id=",">,</span> <span class="token string span__Span-sc-1x0bjnh-0 iZyUgN" id="&#x27;silent&#x27;">&#x27;silent&#x27;</span><span class="token punctuation span__Span-sc-1x0bjnh-0 iZyUgN" id=")">)</span>
  <span class="token punctuation span__Span-sc-1x0bjnh-0 iZyUgN" id="}">}</span><span class="token punctuation span__Span-sc-1x0bjnh-0 iZyUgN" id=",">,</span> <span class="token punctuation span__Span-sc-1x0bjnh-0 iZyUgN" id="{">{</span> presence<span class="token punctuation span__Span-sc-1x0bjnh-0 iZyUgN" id=":">:</span> <span class="token string span__Span-sc-1x0bjnh-0 iZyUgN" id="&#x27;required&#x27;">&#x27;required&#x27;</span> <span class="token punctuation span__Span-sc-1x0bjnh-0 iZyUgN" id="}">}</span><span class="token punctuation span__Span-sc-1x0bjnh-0 iZyUgN" id=")">)</span>
  <span class="token keyword span__Span-sc-1x0bjnh-0 iZyUgN" id="if">if</span> <span class="token punctuation span__Span-sc-1x0bjnh-0 iZyUgN" id="(">(</span>res<span class="token punctuation span__Span-sc-1x0bjnh-0 iZyUgN" id=".">.</span>error<span class="token punctuation span__Span-sc-1x0bjnh-0 iZyUgN" id=")">)</span> <span class="token keyword span__Span-sc-1x0bjnh-0 iZyUgN" id="throw">throw</span> res<span class="token punctuation span__Span-sc-1x0bjnh-0 iZyUgN" id=".">.</span>error
  <span class="token keyword span__Span-sc-1x0bjnh-0 iZyUgN" id="return">return</span> config
<span class="token punctuation span__Span-sc-1x0bjnh-0 iZyUgN" id="}">}</span>

<span class="token comment span__Span-sc-1x0bjnh-0 iZyUgN" id="// bad">// BAD</span>
<span class="token comment span__Span-sc-1x0bjnh-0 iZyUgN" id="// export const config = fromenv() // not extensible in testing">// export const config = fromEnv() // not extensible in testing</span>
<span class="token comment span__Span-sc-1x0bjnh-0 iZyUgN" id="// export const config = create(fromenv()) // not extensible in testing">// export const config = create(fromEnv()) // not extensible in testing</span>


<span class="token comment span__Span-sc-1x0bjnh-0 iZyUgN" id="// examples:">// examples:</span>

<span class="token comment span__Span-sc-1x0bjnh-0 iZyUgN" id="// defaults only">// defaults only</span>
<span class="token comment span__Span-sc-1x0bjnh-0 iZyUgN" id="// $ node application-config/server">// $ node application-config/server</span>
<span class="token comment span__Span-sc-1x0bjnh-0 iZyUgN" id="//   { config: { port: 8080, loglevel: &#x27;warn&#x27; } }">//   { config: { port: 8080, logLevel: &#x27;warn&#x27; } }</span>

<span class="token comment span__Span-sc-1x0bjnh-0 iZyUgN" id="// custom port">// custom port</span>
<span class="token comment span__Span-sc-1x0bjnh-0 iZyUgN" id="// $ port=3333 node application-config/server">// $ PORT=3333 node application-config/server</span>
<span class="token comment span__Span-sc-1x0bjnh-0 iZyUgN" id="//   { config: { port: 3333, loglevel: &#x27;warn&#x27; } }">//   { config: { port: 3333, logLevel: &#x27;warn&#x27; } }</span>

<span class="token comment span__Span-sc-1x0bjnh-0 iZyUgN" id="// [invalid] custom log level">// [invalid] custom log level</span>
<span class="token comment span__Span-sc-1x0bjnh-0 iZyUgN" id="// $ log_level=&#x27;bad-level&#x27; node application-config/server">// $ LOG_LEVEL=&#x27;bad-level&#x27; node application-config/server</span>
<span class="token comment span__Span-sc-1x0bjnh-0 iZyUgN" id="//   validationerror: child &quot;loglevel&quot; fails because [&quot;loglevel&quot; must be one of">//   ValidationError: child &quot;logLevel&quot; fails because [&quot;logLevel&quot; must be one of</span>
<span class="token comment span__Span-sc-1x0bjnh-0 iZyUgN" id="//     [debug, info, ... ]]">//     [debug, info, ... ]]</span></code></pre></div>
<p class="paragraph__Paragraph-sc-2voub2-0 dKQhfr" id="there are millions of ways to manage configuration.  i generally recommend
conforming to ">there are millions of ways to manage configuration.  i generally recommend
conforming to <a target="_blank" href="https://12factor.net/config" class="link__Link-umnslz-0 eFqDVI">12 factor</a> recommendations. however, rather
than putting environment variable checks all over your code, prefer a pure and
testable strategy.</p>
<div class="default__Default-sc-41z5l2-0 fEGoZj" id="
">
<div class="default__Default-sc-41z5l2-0 fEGoZj" id="create a configuration data-structure on boot">create a configuration data-structure on boot</div>
<div class="default__Default-sc-41z5l2-0 fEGoZj" id="inject configuration into your application as needed.">inject configuration into your application as needed.</div>
<div class="default__Default-sc-41z5l2-0 fEGoZj" id="attempt to keep your configuration consolidated/centralized">attempt to keep your configuration consolidated/centralized</div>
<div class="default__Default-sc-41z5l2-0 fEGoZj" id="attempt to keep your configuration immutable/read-only">attempt to keep your configuration immutable/read-only</div>
<div class="default__Default-sc-41z5l2-0 fEGoZj" id="validate configuration (i.e. user input) each time it is created/modified">validate configuration (i.e. user input) each time it is created/modified</div>
</div>
<p class="paragraph__Paragraph-sc-2voub2-0 dKQhfr" id="when configuration is managed as suggested, you will not need advanced or
complicated local testing strategies.  simply create cofiguration (or any resource, really) then pass the resource into modules being tested.">when configuration is managed as suggested, you will not need advanced or
complicated local testing strategies.  simply create cofiguration (or any resource, really) then pass the resource into modules being tested.</p>
<h1 class="heading__Heading1-sc-16djx8k-0 jfrkmZ" id="gracefully update configuration">gracefully update configuration</h1>
<p class="paragraph__Paragraph-sc-2voub2-0 dKQhfr" id="if your application has requests inflight, swapping shared, mutable configuration whilst
outstanding handlers are in proccess may introduce nondeteriminstic or fatal behavior.">if your application has requests inflight, swapping shared, mutable configuration whilst
outstanding handlers are in proccess may introduce nondeteriminstic or fatal behavior.</p>
<p class="paragraph__Paragraph-sc-2voub2-0 dKQhfr" id="if your application needs to swap config at runtime, try to handling these changes
gracefully.  i recommend either:">if your application needs to swap config at runtime, try to handling these changes
gracefully.  i recommend either:</p>
<div class="default__Default-sc-41z5l2-0 fEGoZj" id="
">
<div class="default__Default-sc-41z5l2-0 fEGoZj" id="gracefully restarting the server on receipt of new configuration, or">gracefully restarting the server on receipt of new configuration, or</div>
<div class="default__Default-sc-41z5l2-0 fEGoZj" id="maintaining a stack of immutable configs, only of which one is attached to a request through its lifecycle">maintaining a stack of immutable configs, only of which one is attached to a request through its lifecycle</div>
</div>
<p class="paragraph__Paragraph-sc-2voub2-0 dKQhfr" id="in the latter option, when an older configuration object is no longer consumed by any outstanding requests,
it can be ">in the latter option, when an older configuration object is no longer consumed by any outstanding requests,
it can be <code class="language-text code__Code-sc-1mcw21l-0 flReVN" id="shift">shift</code>ed off of the stack.  the later options also assumes that middlewares
can suffice using configuration off of the request context alone.  if this is not the
case, fall back to the first option.</p>
<h1 class="heading__Heading1-sc-16djx8k-0 jfrkmZ" id="upload files">upload files</h1>
<p class="paragraph__Paragraph-sc-2voub2-0 dKQhfr" id="there&#x27;s a ">there&#x27;s a <a target="_blank" href="https://github.com/koa-modules/multer" class="link__Link-umnslz-0 eFqDVI">middleware</a> for that.</p>
<h1 class="heading__Heading1-sc-16djx8k-0 jfrkmZ" id="serve static files">serve static files</h1>
<p class="paragraph__Paragraph-sc-2voub2-0 dKQhfr" id="there&#x27;s a ">there&#x27;s a <a target="_blank" href="https://github.com/koajs/static" class="link__Link-umnslz-0 eFqDVI">middleware</a> for that.</p>
<h1 class="heading__Heading1-sc-16djx8k-0 jfrkmZ" id="serve an api and a web application">serve an api and a web application</h1>
<blockquote class="blockquote__Blockquote-l1ah9g-0 jgQxbh" id="
">
<p class="paragraph__Paragraph-sc-2voub2-0 dKQhfr" id="api + static server">api + static server</p>
</blockquote>
<div class="gatsby-highlight div__Div-sc-1l67xj5-0 dERKfM"><pre class="language-typescript pre__Pre-sc-1ql72bi-0 hEaywI"><code class="language-typescript code__Code-sc-1mcw21l-0 flReVN"><span class="token comment span__Span-sc-1x0bjnh-0 iZyUgN" id="// api-and-static/server.ts">// api-and-static/server.ts</span>
<span class="token keyword span__Span-sc-1x0bjnh-0 iZyUgN" id="import">import</span> mount <span class="token keyword span__Span-sc-1x0bjnh-0 iZyUgN" id="from">from</span> <span class="token string span__Span-sc-1x0bjnh-0 iZyUgN" id="&#x27;koa-mount&#x27;">&#x27;koa-mount&#x27;</span>
<span class="token keyword span__Span-sc-1x0bjnh-0 iZyUgN" id="import">import</span> serve <span class="token operator span__Span-sc-1x0bjnh-0 iZyUgN" id="=">=</span> <span class="token keyword span__Span-sc-1x0bjnh-0 iZyUgN" id="require">require</span><span class="token punctuation span__Span-sc-1x0bjnh-0 iZyUgN" id="(">(</span><span class="token string span__Span-sc-1x0bjnh-0 iZyUgN" id="&#x27;koa-static&#x27;">&#x27;koa-static&#x27;</span><span class="token punctuation span__Span-sc-1x0bjnh-0 iZyUgN" id=")">)</span>
<span class="token comment span__Span-sc-1x0bjnh-0 iZyUgN" id="// ...">// ...</span>

<span class="token keyword span__Span-sc-1x0bjnh-0 iZyUgN" id="const">const</span> app <span class="token operator span__Span-sc-1x0bjnh-0 iZyUgN" id="=">=</span> <span class="token keyword span__Span-sc-1x0bjnh-0 iZyUgN" id="new">new</span> <span class="token class-name span__Span-sc-1x0bjnh-0 iZyUgN" id="koa">Koa</span><span class="token punctuation span__Span-sc-1x0bjnh-0 iZyUgN" id="(">(</span><span class="token punctuation span__Span-sc-1x0bjnh-0 iZyUgN" id=")">)</span>
<span class="token keyword span__Span-sc-1x0bjnh-0 iZyUgN" id="const">const</span> fileserver <span class="token operator span__Span-sc-1x0bjnh-0 iZyUgN" id="=">=</span> <span class="token keyword span__Span-sc-1x0bjnh-0 iZyUgN" id="new">new</span> <span class="token class-name span__Span-sc-1x0bjnh-0 iZyUgN" id="koa">Koa</span><span class="token punctuation span__Span-sc-1x0bjnh-0 iZyUgN" id="(">(</span><span class="token punctuation span__Span-sc-1x0bjnh-0 iZyUgN" id=")">)</span>
fileserver<span class="token punctuation span__Span-sc-1x0bjnh-0 iZyUgN" id=".">.</span><span class="token function span__Span-sc-1x0bjnh-0 iZyUgN" id="use">use</span><span class="token punctuation span__Span-sc-1x0bjnh-0 iZyUgN" id="(">(</span><span class="token function span__Span-sc-1x0bjnh-0 iZyUgN" id="serve">serve</span><span class="token punctuation span__Span-sc-1x0bjnh-0 iZyUgN" id="(">(</span><span class="token constant span__Span-sc-1x0bjnh-0 iZyUgN" id="public_dirname">PUBLIC_DIRNAME</span><span class="token punctuation span__Span-sc-1x0bjnh-0 iZyUgN" id=")">)</span><span class="token punctuation span__Span-sc-1x0bjnh-0 iZyUgN" id=")">)</span>
<span class="token keyword span__Span-sc-1x0bjnh-0 iZyUgN" id="const">const</span> api <span class="token operator span__Span-sc-1x0bjnh-0 iZyUgN" id="=">=</span> <span class="token keyword span__Span-sc-1x0bjnh-0 iZyUgN" id="new">new</span> <span class="token class-name span__Span-sc-1x0bjnh-0 iZyUgN" id="koa">Koa</span><span class="token punctuation span__Span-sc-1x0bjnh-0 iZyUgN" id="(">(</span><span class="token punctuation span__Span-sc-1x0bjnh-0 iZyUgN" id=")">)</span>
api<span class="token punctuation span__Span-sc-1x0bjnh-0 iZyUgN" id=".">.</span><span class="token function span__Span-sc-1x0bjnh-0 iZyUgN" id="use">use</span><span class="token punctuation span__Span-sc-1x0bjnh-0 iZyUgN" id="(">(</span><span class="token parameter span__Span-sc-1x0bjnh-0 iZyUgN" id="ctx">ctx</span> <span class="token operator span__Span-sc-1x0bjnh-0 iZyUgN" id="=&gt;">=&gt;</span> <span class="token punctuation span__Span-sc-1x0bjnh-0 iZyUgN" id="{">{</span> ctx<span class="token punctuation span__Span-sc-1x0bjnh-0 iZyUgN" id=".">.</span>body <span class="token operator span__Span-sc-1x0bjnh-0 iZyUgN" id="=">=</span> <span class="token punctuation span__Span-sc-1x0bjnh-0 iZyUgN" id="{">{</span> ok<span class="token punctuation span__Span-sc-1x0bjnh-0 iZyUgN" id=":">:</span> <span class="token boolean span__Span-sc-1x0bjnh-0 iZyUgN" id="true">true</span> <span class="token punctuation span__Span-sc-1x0bjnh-0 iZyUgN" id="}">}</span><span class="token punctuation span__Span-sc-1x0bjnh-0 iZyUgN" id="}">}</span><span class="token punctuation span__Span-sc-1x0bjnh-0 iZyUgN" id=")">)</span>
app<span class="token punctuation span__Span-sc-1x0bjnh-0 iZyUgN" id=".">.</span><span class="token function span__Span-sc-1x0bjnh-0 iZyUgN" id="use">use</span><span class="token punctuation span__Span-sc-1x0bjnh-0 iZyUgN" id="(">(</span><span class="token function span__Span-sc-1x0bjnh-0 iZyUgN" id="mount">mount</span><span class="token punctuation span__Span-sc-1x0bjnh-0 iZyUgN" id="(">(</span><span class="token string span__Span-sc-1x0bjnh-0 iZyUgN" id="&#x27;/api&#x27;">&#x27;/api&#x27;</span><span class="token punctuation span__Span-sc-1x0bjnh-0 iZyUgN" id=",">,</span> api<span class="token punctuation span__Span-sc-1x0bjnh-0 iZyUgN" id=")">)</span><span class="token punctuation span__Span-sc-1x0bjnh-0 iZyUgN" id=")">)</span>
app<span class="token punctuation span__Span-sc-1x0bjnh-0 iZyUgN" id=".">.</span><span class="token function span__Span-sc-1x0bjnh-0 iZyUgN" id="use">use</span><span class="token punctuation span__Span-sc-1x0bjnh-0 iZyUgN" id="(">(</span><span class="token function span__Span-sc-1x0bjnh-0 iZyUgN" id="mount">mount</span><span class="token punctuation span__Span-sc-1x0bjnh-0 iZyUgN" id="(">(</span><span class="token string span__Span-sc-1x0bjnh-0 iZyUgN" id="&#x27;/&#x27;">&#x27;/&#x27;</span><span class="token punctuation span__Span-sc-1x0bjnh-0 iZyUgN" id=",">,</span> fileserver<span class="token punctuation span__Span-sc-1x0bjnh-0 iZyUgN" id=")">)</span><span class="token punctuation span__Span-sc-1x0bjnh-0 iZyUgN" id=")">)</span>
app<span class="token punctuation span__Span-sc-1x0bjnh-0 iZyUgN" id=".">.</span><span class="token function span__Span-sc-1x0bjnh-0 iZyUgN" id="listen">listen</span><span class="token punctuation span__Span-sc-1x0bjnh-0 iZyUgN" id="(">(</span><span class="token number span__Span-sc-1x0bjnh-0 iZyUgN" id="3000">3000</span><span class="token punctuation span__Span-sc-1x0bjnh-0 iZyUgN" id=")">)</span>

<span class="token comment span__Span-sc-1x0bjnh-0 iZyUgN" id="// $ curl localhost:3000">// $ curl localhost:3000</span>
<span class="token comment span__Span-sc-1x0bjnh-0 iZyUgN" id="// &lt;html&gt;">// &lt;html&gt;</span>
<span class="token comment span__Span-sc-1x0bjnh-0 iZyUgN" id="//   &lt;h1&gt;ahoy, matees&lt;/h1&gt;">//   &lt;h1&gt;ahoy, matees&lt;/h1&gt;</span>
<span class="token comment span__Span-sc-1x0bjnh-0 iZyUgN" id="// &lt;/html&gt;">// &lt;/html&gt;</span>

<span class="token comment span__Span-sc-1x0bjnh-0 iZyUgN" id="// $ curl localhost:3000/kittens/talk.txt">// $ curl localhost:3000/kittens/talk.txt</span>
<span class="token comment span__Span-sc-1x0bjnh-0 iZyUgN" id="// meow # served straight from disk!">// meow # served straight from disk!</span>

<span class="token comment span__Span-sc-1x0bjnh-0 iZyUgN" id="// $ curl localhost:3000/api">// $ curl localhost:3000/api</span>
<span class="token comment span__Span-sc-1x0bjnh-0 iZyUgN" id="// { &quot;ok&quot;: true }">// { &quot;ok&quot;: true }</span></code></pre></div>
<p class="paragraph__Paragraph-sc-2voub2-0 dKQhfr" id="it&#x27;s commonplace to serve web assets from a fast fileserver, e.g. nginx, and a
supporting api from another.  this isn&#x27;t always the case, however.  it can be
convenient to ship only one executable to provide both value streams.">it&#x27;s commonplace to serve web assets from a fast fileserver, e.g. nginx, and a
supporting api from another.  this isn&#x27;t always the case, however.  it can be
convenient to ship only one executable to provide both value streams.</p>
<h1 class="heading__Heading1-sc-16djx8k-0 jfrkmZ" id="isomorphic rendering">isomorphic rendering</h1>
<h1 class="heading__Heading1-sc-16djx8k-0 jfrkmZ" id="performance - reject requests when overloaded">performance - reject requests when overloaded</h1>
<p class="paragraph__Paragraph-sc-2voub2-0 dKQhfr" id="add ">add <a target="_blank" href="https://github.com/nswbmw/koa-toobusy" class="link__Link-umnslz-0 eFqDVI">koa-toobusy</a> early in your middleware
stack.</p>
<h1 class="heading__Heading1-sc-16djx8k-0 jfrkmZ" id="recipes">recipes</h1>
<a target="_blank" class="link__Link-umnslz-0 eFqDVI">
<p class="paragraph__Paragraph-sc-2voub2-0 dKQhfr" id="weee">weee</p></a></div></div></div></div><script id="gatsby-script-loader">/*<![CDATA[*/window.page={"componentChunkName":"component---src-pages-index-js","jsonName":"index","path":"/"};window.dataPath="614/path---index-6a9-Gjol1j7DfW0SZmIz5G7drtMnoig";/*]]>*/</script><script id="gatsby-chunk-mapping">/*<![CDATA[*/window.___chunkMapping={"app":["/app-50d9e60378460038add4.js"],"component---src-pages-404-js":["/component---src-pages-404-js-1d828825806e8827a9b6.js"],"component---src-pages-index-js":["/component---src-pages-index-js-70d1a2788a0d3b29616f.js"],"pages-manifest":["/pages-manifest-1b51cd862c283a1126fc.js"]};/*]]>*/</script><script src="/component---src-pages-index-js-70d1a2788a0d3b29616f.js" async=""></script><script src="/7-34bcfe8349df4b1d1738.js" async=""></script><script src="/1-4bdc6f16ab9651364ace.js" async=""></script><script src="/styles-ee9eff4b2717b93862c1.js" async=""></script><script src="/app-50d9e60378460038add4.js" async=""></script><script src="/webpack-runtime-6115d14da3dfd47827b0.js" async=""></script></body></html>
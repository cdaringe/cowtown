{"version":3,"sources":["/home/circleci/project/packages/docs/src/manage-configuration.mdx"],"names":["MDXContent","props","_this","Object","_home_circleci_project_node_modules_babel_preset_react_app_node_modules_babel_runtime_helpers_esm_classCallCheck__WEBPACK_IMPORTED_MODULE_1__","this","_home_circleci_project_node_modules_babel_preset_react_app_node_modules_babel_runtime_helpers_esm_possibleConstructorReturn__WEBPACK_IMPORTED_MODULE_3__","_home_circleci_project_node_modules_babel_preset_react_app_node_modules_babel_runtime_helpers_esm_getPrototypeOf__WEBPACK_IMPORTED_MODULE_4__","call","layout","_this$props","components","_home_circleci_project_node_modules_babel_preset_react_app_node_modules_babel_runtime_helpers_esm_objectWithoutProperties__WEBPACK_IMPORTED_MODULE_0__","react__WEBPACK_IMPORTED_MODULE_6___default","a","createElement","_mdx_js_tag__WEBPACK_IMPORTED_MODULE_7__","name","id","parentName","href","className","React","Component","isMDXComponent"],"mappings":"45BAQqBA,cACnB,SAAAA,EAAYC,GAAO,IAAAC,EAAA,OAAAC,OAAAC,EAAA,EAAAD,CAAAE,KAAAL,IACjBE,EAAAC,OAAAG,EAAA,EAAAH,CAAAE,KAAAF,OAAAI,EAAA,EAAAJ,CAAAH,GAAAQ,KAAAH,KAAMJ,KACDQ,OAAS,KAFGP,wEAIV,IAAAQ,EAC0BL,KAAKJ,MAA9BU,EADDD,EACCC,WADDR,OAAAS,EAAA,EAAAT,CAAAO,EAAA,gBAGP,OAAOG,EAAAC,EAAAC,cAACC,EAAA,OAAD,CACEC,KAAK,UAELN,WAAYA,GAAYE,EAAAC,EAAAC,cAACC,EAAA,OAAD,CAAQC,KAAK,KAAKN,WAAYA,EAAYV,MAAO,CAACiB,GAAK,yBAAvD,wBACrCL,EAAAC,EAAAC,cAACC,EAAA,OAAD,CAAQC,KAAK,IAAIN,WAAYA,GAA7B,qGACgBE,EAAAC,EAAAC,cAACC,EAAA,OAAD,CAAQC,KAAK,IAAIN,WAAYA,EAAYQ,WAAW,IAAIlB,MAAO,CAACmB,KAAO,gCAAvE,aADhB,yIAIAP,EAAAC,EAAAC,cAACC,EAAA,OAAD,CAAQC,KAAK,KAAKN,WAAYA,GAC9BE,EAAAC,EAAAC,cAACC,EAAA,OAAD,CAAQC,KAAK,KAAKN,WAAYA,EAAYQ,WAAW,MAArD,yDAAoHN,EAAAC,EAAAC,cAACC,EAAA,OAAD,CAAQC,KAAK,aAAaN,WAAYA,EAAYQ,WAAW,MAA7D,UAApH,WACAN,EAAAC,EAAAC,cAACC,EAAA,OAAD,CAAQC,KAAK,KAAKN,WAAYA,EAAYQ,WAAW,MAArD,+EACAN,EAAAC,EAAAC,cAACC,EAAA,OAAD,CAAQC,KAAK,KAAKN,WAAYA,EAAYQ,WAAW,MAArD,+DACAN,EAAAC,EAAAC,cAACC,EAAA,OAAD,CAAQC,KAAK,KAAKN,WAAYA,EAAYQ,WAAW,MAArD,0DACAN,EAAAC,EAAAC,cAACC,EAAA,OAAD,CAAQC,KAAK,KAAKN,WAAYA,EAAYQ,WAAW,MAArD,8EAEAN,EAAAC,EAAAC,cAACC,EAAA,OAAD,CAAQC,KAAK,IAAIN,WAAYA,GAA7B,wQAGaE,EAAAC,EAAAC,cAACC,EAAA,OAAD,CAAQC,KAAK,IAAIN,WAAYA,EAAYQ,WAAW,IAAIlB,MAAO,CAACmB,KAAO,uDAAvE,wBAHb,KAIAP,EAAAC,EAAAC,cAACC,EAAA,OAAD,CAAQC,KAAK,MAAMN,WAAYA,GAAYE,EAAAC,EAAAC,cAACC,EAAA,OAAD,CAAQC,KAAK,OAAON,WAAYA,EAAYQ,WAAW,MAAMlB,MAAO,CAACoB,UAAY,wBAAjF,mhEA3BHC,IAAMC,+WAqG9CvB,EAAWwB,gBAAiB","file":"static/js/src-manage-configuration.40fd0249.js","sourcesContent":["\n  import React from 'react'\n  import { MDXTag } from '@mdx-js/tag'\n  \n\nconst layoutProps = {\n  \n};\nexport default class MDXContent extends React.Component {\n  constructor(props) {\n    super(props)\n    this.layout = null\n  }\n  render() {\n    const { components, ...props } = this.props\n\n    return <MDXTag\n             name=\"wrapper\"\n             \n             components={components}><MDXTag name=\"h1\" components={components} props={{\"id\":\"manage-configuration\"}}>{`manage configuration`}</MDXTag>\n<MDXTag name=\"p\" components={components}>{`there are seemingly inifinite ways to manage configuration.  i generally recommend\nconforming to `}<MDXTag name=\"a\" components={components} parentName=\"p\" props={{\"href\":\"https://12factor.net/config\"}}>{`12 factor`}</MDXTag>{` recommendations. however, rather\nthan putting environment variable checks all over your code, prefer a pure and\ntestable strategy.`}</MDXTag>\n<MDXTag name=\"ul\" components={components}>\n<MDXTag name=\"li\" components={components} parentName=\"ul\">{`create a configuration data-structure on boot, e.g. a `}<MDXTag name=\"inlineCode\" components={components} parentName=\"li\">{`Config`}</MDXTag>{` object`}</MDXTag>\n<MDXTag name=\"li\" components={components} parentName=\"ul\">{`pass `}{`[slices of]`}{` configuration deeper into your application as needed`}</MDXTag>\n<MDXTag name=\"li\" components={components} parentName=\"ul\">{`attempt to keep your configuration consolidated/centralized`}</MDXTag>\n<MDXTag name=\"li\" components={components} parentName=\"ul\">{`attempt to keep your configuration immutable/read-only`}</MDXTag>\n<MDXTag name=\"li\" components={components} parentName=\"ul\">{`validate configuration (i.e. user input) each time it is created/replaced`}</MDXTag>\n</MDXTag>\n<MDXTag name=\"p\" components={components}>{`when configuration is managed as suggested, you will not need advanced or\ncomplicated local testing strategies.  simply create configuration (or any resource, really)\nthen pass the resource into modules being tested. this is also often considered\nfunctional `}<MDXTag name=\"a\" components={components} parentName=\"p\" props={{\"href\":\"https://en.wikipedia.org/wiki/Dependency_injection\"}}>{`dependency injection`}</MDXTag>{`.`}</MDXTag>\n<MDXTag name=\"pre\" components={components}><MDXTag name=\"code\" components={components} parentName=\"pre\" props={{\"className\":\"language-typescript\"}}>{`// application-config/server.ts\nimport { create as createConfig, fromEnv } from './config'\nimport Koa from 'koa'\nasync function start () {\n  const app = new Koa()\n  const config = createConfig(fromEnv())\n  // createMiddlewares(config)\n  // createServices({ app, config: config.services })\n  console.log({ config })\n  app.listen(config.port)\n}\nstart()\n\n\n// application-config/config.ts\nimport joi from 'joi'\n\ntype Config = {\n  port: number\n  logLevel: 'debug' | 'info' | 'warn' | 'error' | 'silent'\n}\n\nexport const fromEnv: () => Partial<Config> = () => {\n  const partialConfig: Partial<Config> = {};\n  if (process.env.PORT) partialConfig.port = parseInt(process.env.PORT)\n  if (process.env.LOG_LEVEL) partialConfig.logLevel = process.env.LOG_LEVEL as any\n  return partialConfig\n}\n\n// GOOD\nexport const create: (partial?: Partial<Config>) => Config = (partial = {}) => {\n  // create a complete configuration container, providing universally applicable\n  // defaults/fallbacks\n  const { port, logLevel } = partial\n  const config: Config = {\n    port: port || 8080,\n    logLevel: logLevel || 'warn'\n  }\n  validate(config)\n  return config\n}\n\nexport const validate = (config: Config) => {\n  const res = joi.validate(config, {\n    port: joi.number().min(0),\n    logLevel: joi.any().valid('debug', 'info', 'warn', 'error', 'silent')\n  }, { presence: 'required' })\n  if (res.error) throw res.error\n  return config\n}\n\n// BAD\n// export const config = fromEnv() // not extensible in testing\n// export const config = create(fromEnv()) // not extensible in testing\n\n\n// examples:\n\n// defaults only\n// $ node application-config/server\n//   { config: { port: 8080, logLevel: 'warn' } }\n\n// custom port\n// $ PORT=3333 node application-config/server\n//   { config: { port: 3333, logLevel: 'warn' } }\n\n// [invalid] custom log level\n// $ LOG_LEVEL='bad-level' node application-config/server\n//   ValidationError: child \"logLevel\" fails because [\"logLevel\" must be one of\n//     [debug, info, ... ]]\n`}</MDXTag></MDXTag>\n           </MDXTag>\n  }\n}\nMDXContent.isMDXComponent = true\n  "],"sourceRoot":""}